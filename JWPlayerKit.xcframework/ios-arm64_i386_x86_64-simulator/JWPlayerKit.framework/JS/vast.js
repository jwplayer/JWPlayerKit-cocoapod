!function(){"use strict";var e,t="vast",i="time",r="paused",n="playing",a="fullscreen",s="volume",o="mute",l="viewable",d="resize",h="adClick",u="adComplete",c="adError",p="adImpression",f="adItem",m="adLoadedXML",v="mediaLoaded",g="adMeta",y="adPause",k="adPlay",A="adPlayComplete",P="adPodError",w="adSkipped",b="adStarted",E="clickthrough",T="external",_=T,I="click",C="play",S="error",x="complete",R=[p,c,P],j=[b,u,p,h,w,c,k,y,g],O="instream",V="article",M=((e={})[[O]]=1,e[["banner"]]=2,e[[V]]=3,e[["feed"]]=4,e[["floating"]]=5,e[["interstitial"]]=5,e[["slider"]]=5,e);function B(){return B=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},B.apply(this,arguments)}var L=function(e,t,i){var r=document.createElement("param");r.setAttribute("name",t),r.setAttribute("value",i),e.appendChild(r)},H=function(){function e(e,t,i){this.debugTrackFn=e,this.div=null,this.elem=null,this.environment=t,this.utils=i}var t=e.prototype;return t.addCompanion=function(e,t){if(this.div=e,this.elem=document.getElementById(this.div.id),!this.elem)return!1;for(var i=0;i<t.length;i++)if(this.fitsDiv(t[i]))return this.placeCompanion(t[i]),!0;return!1},t.removeCompanion=function(){this.elem.innerHTML=""},t.sendPings=function(e){(e=e.creativeView)&&(e.forEach((function(e){(new Image).src=e})),"function"==typeof this.debugTrackFn&&this.debugTrackFn({type:"companion",data:{trackers:e}}))},t.placeCompanion=function(e){var t=this;if(this.removeCompanion(),"html"===e.type){var i=document.createElement("div");i.innerHTML=e.source;var r=i.getElementsByTagName("script"),n=this.utils.scriptloader;return r.length&&r.forEach((function(e){new n(e.src).load(),e.parentElement.removeChild(e)})),this.elem.appendChild(i),void this.sendPings(e.trackers)}if("iframe"===e.type){var a=document.createElement("iframe");return a.height=this.div.height,a.width=this.div.width,a.src=e.source,a.scrolling="no",a.style.border="none",a.marginWidth=0,a.marginHeight=0,this.sendPings(e.trackers),this.elem.innerHTML="",void this.elem.appendChild(a)}if("application/x-shockwave-flash"===e.type){var s=document.createElement("object");return s.setAttribute("type","application/x-shockwave-flash"),s.setAttribute("data",e.source),s.setAttribute("width","100%"),s.setAttribute("height","100%"),s.setAttribute("tabindex",0),L(s,"allowfullscreen","true"),L(s,"allowscriptaccess","always"),L(s,"seamlesstabbing","true"),L(s,"wmode","opaque"),this.elem.appendChild(s),void this.sendPings(e.trackers)}var o=new Image;o.src=e.source,e.clickthrough&&(o.onclick=function(){t.utils.openLink(e.clickthrough,"_blank",{rel:"noreferrer"})}),this.elem.innerHTML="",this.elem.appendChild(o),this.sendPings(e.trackers)},t.fitsDiv=function(e){return e.width===this.div.width&&e.height===this.div.height},e}(),N=document.createElement("img"),D=document.createElement("img");N.src=D.src='data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><circle cx="32" cy="32" r="32" fill="%23191919"/><line stroke="%23CCC" stroke-width="6" x1="32" y1="20" x2="32" y2="44"/><line stroke="%23CCC" stroke-width="6" x1="20" y1="32" x2="44" y2="32"/></svg>',N.className="jw-vast-nonlinear-open-button",D.className="jw-vast-nonlinear-close-button";var q,F=function(){function e(e,t,i,r,n){this.player=e,this.environment=e.getEnvironment(),this.div=r,this.staticURL=t,this.clickURL=i,this.loadTimer=-1,this.animationTimer=-1,this.banner=null,B(this,e.Events),this.banner=document.createElement("img"),this.banner.className="jw-banner",this.banner.id=this.player.id+"_vast_static",this.div.appendChild(N),this.div.appendChild(this.banner),this.div.appendChild(D),this.loadTimer=setTimeout(this.imageLoadError.bind(this),n),this.banner.onerror=this.imageLoadError.bind(this),this.banner.onload=this.onLoaded.bind(this),this.banner.src=this.staticURL}var t=e.prototype;return t.onLoaded=function(){if(clearTimeout(this.loadTimer),0!==this.banner.naturalWidth){this.removeBannerEventListeners();var e=this.player.utils;e.addClass(this.div,"jw-vast-nonlinear-active"),e.style(D,{bottom:this.banner.height-8,left:this.banner.width},!0),new e.UI(this.banner).on("click",this.sendClick.bind(this)),D.onclick=D.ontouchstart=this.collapse.bind(this),N.onclick=N.ontouchstart=this.expand.bind(this),this.trigger(C)}else this.imageLoadError()},t.imageLoadError=function(){clearTimeout(this.loadTimer),this.trigger(S),this.removeBanner()},t.sendClick=function(){this.trigger(I)},t.collapse=function(e){var t=this;e.preventDefault(),this.player.utils.addClass(this.div,"jw-vast-nonlinear-collapsed"),this.animationTimer=setTimeout((function(){t.remove(t.banner),t.remove(D),t.animationTimer=-1}),250)},t.expand=function(e){-1===this.animationTimer&&(e.preventDefault(),this.player.utils.removeClass(this.div,"jw-vast-nonlinear-collapsed"),this.div.appendChild(this.banner),this.div.appendChild(D))},t.remove=function(e){this.div.contains(e)&&this.div.removeChild(e)},t.removeBannerEventListeners=function(){this.banner.onload=this.banner.onerror=null},t.removeBanner=function(){this.removeBannerEventListeners(),this.remove(this.banner)},t.removeListeners=function(){clearTimeout(this.loadTimer),clearTimeout(this.animationTimer),D.onclick=D.ontouchstart=N.onclick=N.ontouchstart=null,this.off(),this.removeBannerEventListeners()},t.stop=function(){this.player.utils.removeClass(this.div,"jw-vast-nonlinear-active jw-vast-nonlinear-collapsed"),this.removeBanner(),this.remove(D),this.remove(N)},e}(),U=function(){function e(e,t){this.player=e,this.div=t,this.startTime=0,this.minDur=0,this.environment=e.getEnvironment(),B(this,e.Events),this.type="static",e.on("time",this.dispatchTime,this)}var t=e.prototype;return t.playAd=function(e,t,i,r,n){this.minDur=this.player.utils.seconds(i),this.adTag=r,this.static&&(this.static.removeListeners(),this.static.stop()),this.player.utils.addClass(this.div,"jw-vast-nonlinear"),this.static=new F(this.player,e,t,this.div,n),this.static.on(C,this.startAd,this),this.static.on(I,this.clickHandler,this),this.static.on(S,this.errorHandler,this)},t.dispatchTime=function(e){this.trigger(i,e)},t.startAd=function(){this.startTime=this.player.getPosition(),this.minDur>0&&(0===this.startTime?this.on(i,this.startTimingAd,this):this.on(i,this.timeAd,this)),this.sendEvent(C)},t.startTimingAd=function(e){this.startTime=e.position,this.off(i,this.startTimingAd,this),this.on(i,this.timeAd,this)},t.timeAd=function(e){e.position-this.startTime>this.minDur&&(this.off(i,this.timeAd,this),this.stop())},t.clickHandler=function(){this.sendEvent(I)},t.errorHandler=function(){this.sendEvent(S)},t.sendEvent=function(e,t){(t=t||{}).tag=t.tag||this.adTag,this.trigger(e,t)},t.removeEvents=function(){this.off()},t.getState=function(){return n},t.stop=function(){this.startTime&&this.static&&(this.startTime=0,this.minDur=0,this.off(i,this.startTimingAd,this),this.off(i,this.timeAd,this),this.static.removeListeners(),this.static.stop(),this.sendEvent(x))},t.pause=function(){},t.destroy=function(){this.off(),this.player.off("time",this.dispatchTime,this),this.static&&(this.static.removeListeners(),this.static.stop())},e}(),Q=/^(https?:\/\/).*.(?:ampproject.org|bing-amp.com)\/(?:.\/)*(.*)\/amp.*$/,W=/^[^/]*:\/\/\/?([^]*)/,X=function(e){var t=e.match(W);return t&&t.length>1?t[1]:""},z=/^[^:?#]+:?\/\/[^?#]+/,G=function(){var e,t,i=null!==document.referrer.match(z)?(e=document.referrer,(t=e.match(Q))&&t.length>1?""+t[1]+t[2]:e):"";if(window.top!==window.self){try{return{url:window.top.location.href,domain:window.top.document.domain,referrer:i}}catch(e){}return{url:i,domain:X(i),referrer:""}}return{url:document.location.href,domain:document.domain,referrer:i}},J=function(e){var t=e.advertising;if(t&&t.placement){var i=t.placement.toLowerCase();if(M[i])return M[i]}return M[t&&t.outstream?V:O]},$=function(e,i,r){void 0===i&&(i=null),void 0===r&&(r={});var n={client:t};if(null===e)return n;var a=e.bidding,s=e.config,o=e.item,l=e.player;e.isDestroyed()||(n.placement=J(l.getConfig()));var d=r.schedule;if(d)return B(n,{item:o,tag:d.getVMAP(),adbreaks:d.getAllAds().map((function(e){var t={type:e._type,offset:e._offSet};if(e._vmap?t.vmap=e._vmap:t.adbreak=B({},e._adbreak),a){var i=a.getBid(e.adPlayId);i&&B(t,i.getEventObject())}return t}))});if(s.preloadAds&&(n.preloadAds=r.preload||i&&i._preload||!1),r.jwpseg&&(n.jwpseg=r.jwpseg),i){var h=e.getAdIds(i,r),u=h.adBreakId,c=h.adPlayId;if(B(n,{adBreakId:u,adPlayId:c,offset:i._offSet}),a){var p=a.getBid(c);p&&B(n,p.getEventObject())}}var f=i&&(r.tag||i._currentTag);if(f&&(B(n,{id:i._id,tag:f,adposition:i._position,sequence:i._adPodIndex+1,witem:i._waterfallIndex+1,wcount:i._adQueue?i._adQueue.length:1,adsystem:i.adsystem||""}),i.adServingId&&(n.adServingId=i.adServingId),void 0!==i.skipoffset&&(n.skipoffset=i.skipoffset),i.wrappedTags&&B(n,{wrapperAdSystem:i.wrapper||"",wrappedTags:i.wrappedTags.slice(1)}),i._adbreak&&(n.adschedule=i._adbreak,n.adschedule.offset=i._offSet)),i&&i.companions&&r.companions)return n.companions=r.companions,n;if(i&&i.response){var m=e.params;B(n,{adtitle:i.adTitle||"",description:i.description||"",adId:i.adId||"",adVerifications:i.adVerifications||null,advertiser:i.advertiser||"",advertiserId:i.advertiserId||"",creativeId:i.creativeId||"",creativeAdId:i.creativeAdId||"",dealId:i.dealId||"",request:i.request,response:i.response,conditionalAd:i.conditionalAd,conditionalAdOptOut:m.conditionaladoptout,vastversion:i.vastversion,clickThroughUrl:i.clickthrough,duration:r.duration,linear:r.linear}),"boolean"==typeof i.mediaFileCompliance&&(n.mediaFileCompliance=i.mediaFileCompliance,i.nonComplianceReasons&&(n.nonComplianceReasons=i.nonComplianceReasons)),i.selectedMedia&&(n.mediafile={file:i.selectedMedia.file}),r.metadata&&(n.adMessage=m.dynamicMessage||"",i.companions&&(n.companions=i.companions),i.sequence&&(n.podMessage=m.podMessage||""),void 0!==i.skipoffset&&B(n,{skipMessage:m.skipMessage,skipText:m.skipText}))}else n.item=o;return n},Y=function(e,t,i,r){var n=$(e,i,r),a=t.adErrorCode||60900;return B(n,{message:t.message,code:t.code>=100&&t.code<=1008?t.code:900,adErrorCode:a}),10402===a||50004===a||50400===a?n.timeout=i?i.creativeTimeout:r.creativeTimeout:11007!==a&&10301!==a&&60006!==a||(n.timeout=i?i.requestTimeout:r.requestTimeout),void 0!==t.id&&(n.id=t.id),void 0!==t.sourceError&&(n.sourceError=t.sourceError),void 0!==t.tag&&(n.tag=t.tag),void 0!==t.vmap&&(n.vmap=t.vmap),n},K=function(e){return e.isBeforePlay()||0===e.getPosition()&&"idle"===e.getState()?"pre":e.isBeforeComplete()||e.getPosition()===e.getDuration()?"post":"mid"};function Z(e,t){return Z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Z(e,t)}var ee="vast",te="googima",ie="[ERRORCODE]",re="vmap",ne="-1",ae="cust_params=",se=5e3,oe=5e3,le="adBreakIgnored",de="adError",he="__jwpseg__",ue="instream",ce="article",pe=((q={})[[ue]]=1,q[["banner"]]=2,q[[ce]]=3,q[["feed"]]=4,q[["floating"]]=5,q[["interstitial"]]=5,q[["slider"]]=5,q),fe=new RegExp(/^[^/]*:\/\/\/?([^/]*)/);function me(e){var t=e.match(fe);return t&&t.length>1?t[1]:""}var ve=new RegExp(/^[^:/?#]+:?\/\/[^/?#]+/);var ge=/^(https?:\/\/).*.(?:ampproject.org|bing-amp.com)\/(?:.\/)*(.*)\/amp.*$/;function ye(e){var t=new RegExp("[?&]"+e+"=([^&]*)"),i=document.location.search.match(t);if(i)return decodeURIComponent(i[1])}var ke=null,Ae={gdprApplies:!0,consentData:""},Pe=function(e){return void 0===e&&(e=1e3),null===ke&&(ke=new Promise((function(e){var t=window.__tcfapi||we("__tcfapi");if(t)return t("getTCData",2,(function(t,i){e(!1!==i?{gdprApplies:t.gdprApplies,consentData:t.tcString,addtlConsent:t.addtlConsent}:null)}));var i=window.__cmp||we("__cmp");if(i)return i("getConsentData",null,(function(t,i){e(!1!==i?{gdprApplies:t.gdprApplies||t.isUserInEu,consentData:t.consentData}:null)}));var r=function(){if(ye("isAMP")){var e=ye("consentValue"),t=ye("consentGdpr");if(e||t)return{gdprApplies:t,consentData:e}}}();return e(r||{gdprApplies:!1,consentData:""})})).then((function(e){return e&&(Ae=e),Ae}))),Promise.race([ke,new Promise((function(t){setTimeout(t,e,Ae)}))])},we=function(e){var t=function(e){for(var t=window;t;){try{if(t.frames[e])break}catch(e){}t=t===window.top?null:t.parent}return t}(e+"Locator");return null!==t&&function(i,r,n,a){var s,o,l=be();window.addEventListener("message",(function t(i){var r=i?i.data:{};if("string"==typeof r)try{r=JSON.parse(r)}catch(e){r={}}var a=e+"Return";r[a]&&r[a].callId===l&&(removeEventListener("message",t),n(r[a].returnValue,r[a].success))}),!1);var d=((o={})[[e+"Call"]]=((s={command:i,callId:l,parameter:a})[[void 0!==a?"version":"parameter"]]=r,s),o);t.postMessage(JSON.stringify(d),"*")}},be=Date.now||function(){return(new Date).getTime()};function Ee(e){var t=e.advertising;if(t&&t.placement){var i=t.placement.toLowerCase();if(pe[i])return pe[i]}return pe[t&&t.outstream?ce:ue]}function Te(){var e,t,i=null!==document.referrer.match(ve)?(e=document.referrer,(t=e.match(ge))&&t.length>1?""+t[1]+t[2]:e):"";if(window.top!==window.self){try{return{url:window.top.location.href,domain:window.top.document.domain,referrer:i}}catch(e){}return{url:i,domain:me(i),referrer:""}}return{url:document.location.href,domain:document.domain,referrer:i}}function _e(e,t){var i,r=e.getPlugin("inference"),n=t.jwpseg_client_side,a=t.jwpseg||[];if(!n||!n.length||!r)return a;try{i=r.predict(n,t)}catch(e){return t.jwpseg||[]}var s=Object.keys(i).filter((function(e){return i[e]})),o=a.filter((function(e){return-1===n.indexOf(e)}));return[].concat(s,o)}function Ie(e,t,i){void 0===t&&(t=null),void 0===i&&(i={});var r={client:e.client},n=e.bidding,a=e.item,s=e.player;if(e.isDestroyed()||B(r,{placement:Ee(s.getConfig()),viewable:s.getViewable()}),i.jwpseg&&(r.jwpseg=i.jwpseg),t){var o=e.getAdIds(t,i),l=o.adBreakId,d=o.adPlayId;if(B(r,{adBreakId:l,adPlayId:d,offset:t._offSet}),n){var h=n.getBid(d);h&&B(r,h.getEventObject())}}return r.item=a,r}function Ce(e,t,i,r){return{client:r,message:e,adErrorCode:t,id:ne,placement:Ee(i),tag:""}}var Se=/^((https?:)?\/\/)?(secure)?pubads\.g\.doubleclick\.net\/gampad\/ads\?[\S]*$/;function xe(e,t,i,r,n,a){if(void 0===a&&(a={}),!e)return Promise.resolve(e);var s=function(e,t){var i=e.getConfig(),r=e.getPlaylistItem()===t,n={playerHeight:e.getHeight()||i.height||"",playerWidth:e.getWidth()||i.width||"",itemDuration:r&&je(e.getDuration(),3)||"",item:t,jwpseg:_e(e,t),placement:Ee(i),userAgent:navigator.userAgent},a=i.advertising?i.advertising.ampMacros:{};return B(n,a)}(t,i),o=Te();-1!==e.indexOf(he)&&(a.jwpseg=s.jwpseg),e=Re(e,"__random-number__",Math.random()*Math.pow(10,18)),e=Re(e,"__timestamp__",(new Date).getTime()),e=Re(e,"__page-url__",encodeURIComponent(s.pageUrl||o.url)),e=Re(e,"__referrer__",encodeURIComponent(s.referrer||o.referrer)),e=Re(e,"__player-height__",s.playerHeight),e=Re(e,"__player-width__",s.playerWidth),e=Re(e,"__item-duration__",s.itemDuration),e=Re(e,he,s.jwpseg),e=Re(e,"__domain__",encodeURIComponent(s.domain||o.domain)),e=Re(e,"__placement__",s.placement),e=Re(e,"__device-ua__",encodeURIComponent(s.userAgent)),e=n.companion?Re(e,"__companion-div__",n.companion.id):Re(e,"__companion-div__","");for(var l=Object.keys(s).filter((function(e){return-1!==e.indexOf("item")})),d=l.map((function(e){var t=e.match(/item([\w]+?)(List)?$/);if(t)return t[1].toLowerCase()})),h=null,u=/__item-([\w-]+?)(-list)?__/g,c=e;null!==(h=u.exec(c));){var p=h[0],f=h[1],m=l[d.indexOf(f)],v="";if(i.hasOwnProperty(f)&&"string"==typeof i[f]||m){v=m?s[m]:i[f];var g=!1===n.truncateMacros?4096:1e3;v.length>g&&(v=v.substring(0,g));var y=h[2]?",":null;v=v.split(y).map(encodeURIComponent)}e=Re(e,p,v)}if(r===ee){var k=t.getConfig().autostart?1:0,A=t.getMute()?1:0;e=function(e,t,i){Se.test(e)&&(e=e+"&vpa="+t+"&vpmute="+i);return e}(e,k,A)}if(r===te&&i.title&&-1===e.indexOf("vid_t=")){var P=i.title.substring(0,100).replace(/[^\x00-\x7F]/g,"");e+=function(e){return-1!==e.indexOf("?")?"&":"?"}(e)+"vid_t="+encodeURIComponent(P)}return-1!==e.indexOf("__gdpr__")||-1!==e.indexOf("__gdpr_consent__")||-1!==e.indexOf("__addtl_consent__")?Pe().then((function(t){var i=t.gdprApplies,r=t.consentData,n=t.addtlConsent;return e=Re(e,"__gdpr__",i?1:0),e=Re(e,"__addtl_consent__",n||""),Re(e,"__gdpr_consent__",r||"")})).catch((function(){return e})):Promise.resolve(e)}function Re(e,t,i){return e.replace(t,i)}function je(e,t){var i=Math.pow(10,t);return Math.round(e*i)/i}var Oe=Array.prototype,Ve=Oe.forEach,Me=Oe.map,Be=function(){};function Le(e,t,i){if(Ue(e,"VMAP",re).length)return function(e,t,i){var r=[];Xe(Ue(e,"VMAP",re)[0],"version")||De(r,"VMAP Schema Error: version missing from VMAP tag",ne);var n=Ue(e,"AdBreak",re);n.length||qe();for(var a=e.lookupNamespaceURI(re),s={},o=0;o<n.length;o++){var l={},d={},h=n[o],u=Xe(h,"timeOffset"),c=Xe(h,"breakId"),p=Xe(h,"breakType"),f=Xe(Ue(h,"AdSource",re)[0],"id"),m=Ue(h,"AdTagURI",re)[0],v=Ue(h,"VASTData",re)[0]||Ue(h,"VASTAdData",re)[0],g=Xe(m,"templateType"),y=Ge(m),k=We(a,h,"Tracking",re);if(p||De(r,"VMAP Schema Error: missing breakType on AdBreak",c),v||g||De(r,"VMAP Schema Error: missing templateType on AdBreak",c),u||De(r,"VMAP Schema Error: missing timeOffset on AdBreak",c),l._type=p,l._vmap={id:f,breakid:c,timeoffset:u},v)l._adXML=He(Qe(v,"VAST"));else{if("vast2"!==g&&"vast3"!==g&&"vast4"!==g)continue;l._adQueue=[y],l._waterfallIndex=0}var A=[];if(k)for(var P=0;P<k.length;P++){ze(d,k[P]);var w=Xe(k[P],"event");A.push(w)}if((A.indexOf("breakStart")<0||A.indexOf("breakEnd")<0||A.indexOf("error")<0)&&De(r,"Tracking events are missing breakStart, breakEnd, or error for AdBreak",c),l._trackers=d,l._type=p,u&&!s[u])s[u]=l,s[u]._pod=l._adQueue?[].concat(l._adQueue):[];else if(u&&s[u]){var b;if(l._adQueue)(b=s[u]._pod).push.apply(b,l._adQueue)}}Object.keys(s).forEach((function(e){var r=s[e];switch(r._pod&&r._pod.length<=1&&delete r._pod,e){case"start":r._offSet="pre",t.setPreRoll(r);break;case"100%":case"end":r._offSet="post",t.setPostRoll(r);break;default:if(/^#/.test(e))break;/^\d\d?(?:\.\d+)?%$/.test(e)?r._offSet=e:r._offSet=i.seconds(e),t.addMidRoll(r)}})),t.preRoll||t.midRolls.length||t.postRoll||qe();return t.sort(null,!0),r}(e,t,i);if(Ue(e,"Playlist",re).length)return function(e,t,i){var r=Ue(e,"Playlist",re)[0],n=r.getElementsByTagName("Preroll")[0],a=r.getElementsByTagName("Postroll")[0],s=Ne(n,"pre"),o=Ne(a,"post");s&&t.setPreRoll(s);o&&t.setPostRoll(o);for(var l=r.getElementsByTagName("Midroll"),d=0;d<l.length;d++){var h=l[d],u=i.seconds(h.getAttribute("timeOffset")),c=Ne(h,u);t.addMidRoll(c)}return[]}(e,t,i);throw new Error("No VMAP tag in response")}function He(e){return e.ownerDocument instanceof Document?e.outerHTML||(new XMLSerializer).serializeToString(e):null}function Ne(e,t){if(!e)return null;var i=e.getElementsByTagName("Ad");if(!i.length)return null;var r={_offSet:t};if(1===i.length)r._adQueue=[i[0].textContent.trim()];else{r._pod=[];for(var n=0;n<i.length;n++)r._pod.push(i[n].textContent.trim())}return r}function De(e,t,i){e.push({message:t,code:1002,adErrorCode:70001,id:i})}function qe(){var e=new Error("No AdBreaks in VMAP");throw e.adErrorCode=60005,e}var Fe=function(){function e(e,t){this.utils=t,this._error=null,this._version=null,e&&this.parse(e)}var t=e.prototype;return t.error=function(){return this._error},t.version=function(){return this._version},t.parse=function(e,t){var i,r=this;"VAST"===e.nodeName?i=e:(i=Qe(e,"VAST"))||(i=Qe(e,"VideoAdServingTemplate")),i||this.throwError(101,"Invalid VAST response");var n="VideoAdServingTemplate"===i.tagName?1:parseFloat(Xe(i,"version")||0);this._version=n;var a,s=Ue(i,"Ad"),o=Me.call(s,(function(i){var a=r.parseAd(n,i);return a.vastversion=n,a.response=e,a.request=t||null,a}));return o.length||(a=Ue(i,"Error"),Ve.call(a,(function(e){var t=Ge(e).replace(ie,303);(new Image).src=t}))),o.extensionNodes=this.parseExtensions(e),o},t.parseAd=function(e,t,i){i=i||{};var r,n,a,s,o,l=Qe(t,"InLine"),d=Qe(t,"Wrapper"),h=l||d,u=Qe(h,"Advertiser"),c=Qe(h,"AdVerifications");return c&&(i.adVerifications=(n=Ue(c,"Verification"),a=[],Ve.call(n,(function(e){var t=Xe(e,"vendor"),i=Qe(e,"JavaScriptResource"),r=Qe(e,"ExecutableResource"),n=Ge(Qe(e,"VerificationParameters")),s=Ue(Qe(e,"TrackingEvents"),"Tracking"),o={},l={vendor:t,verificationParameters:n,trackers:o};i&&(l.javaScriptResource={url:Ge(i),apiFramework:Xe(i,"apiFramework"),browserOptional:Xe(i,"browserOptional")}),r&&(l.executableResource={url:Ge(r),apiFramework:Xe(r,"apiFramework"),type:Xe(r,"type")}),Ve.call(s,(function(e){ze(o,e)})),a.push(l)})),a)),i.sequence=Xe(t,"sequence"),i.adId=Xe(t,"id"),i.adTitle=Ge(Qe(h,"AdTitle")),i.advertiser=Ge(u),i.advertiserId=Xe(u,"id"),i.description=Ge(Qe(h,"Description")),i.dealId=Ge(Qe(h,"DealId")),(!e||e>4.2||e<2)&&this.throwError(102,"Vast version not supported"),e>=4&&(i.conditionalAd=!!Xe(t,"conditionalAd")),h?(r=function(e,t,i){var r=Ue(Qe(e,"Creatives"),"Creative"),n={},a={trackers:n};a.adServingId=Ge(Qe(e,"AdServingId")),a.adsystem=Ge(Qe(e,"AdSystem"));var s=Ue(e,"Category");return a.categories=Me.call(s,(function(e){return Ge(e)})),Ve.call(r,(function(e){var r=Qe(e,"Linear"),s=Qe(e,"NonLinear"),o=Ue(Qe(e,"TrackingEvents"),"Tracking");if(t>=4){var l=Ue(e,"UniversalAdId");a.universalAdId=Me.call(l,(function(e){return{universalAdIdRegistry:Xe(e,"idRegistry")||"unknown",universalAdIdValue:Ge(e)||Xe(e,"idValue")||"unknown"}}))}a.creativeId=Xe(e,"id"),a.creativeAdId=Xe(e,"adId"),r&&(a.linear=!0),(r||s)&&Ve.call(o,(function(e){ze(n,e)}));var d=Ge(Qe(e,"AdParameters"));if(d&&(a.adParams=d),r){var h=Qe(r,"VideoClicks"),u=Ge(Qe(h,"ClickThrough")),c=Ue(h,"ClickTracking"),p=Xe(r,"skipoffset"),f=Ge(Qe(r,"Duration"));Ve.call(c,(function(e){Je(n,"click",Ge(e))})),f&&(a.duration=i.seconds(f)),u&&(a.clickthrough=u),void 0!==p&&(a.skipoffset=p),function(e,t){var i=Ue(Qe(e,"MediaFiles"),"MediaFile"),r=t.media?t.media:[];t.media=r.concat(Me.call(i,(function(e){return{type:Xe(e,"type"),file:Ge(e),adType:Xe(e,"apiFramework")||"",width:parseInt(Xe(e,"width"),10)||0,height:parseInt(Xe(e,"height"),10)||0,bitrate:parseInt(Xe(e,"bitrate"),10)||null,maxBitrate:parseInt(Xe(e,"maxBitrate"),10)||null}})).filter((function(e){return e.file})))}(r,a),function(e,t){var i=Ue(e,"Icon");t.icons=Array.prototype.reduce.call(i,(function(e,t){var i,r;if(i=Qe(t,"StaticResource"))r=Xe(i,"creativeType");else if(i=Qe(t,"IFrameResource"))r="iframe";else{if(!(i=Qe(t,"HTMLResource")))return e;r="html"}var n=Ge(i),a={};a.iconClick=Ge(Qe(t,"IconClickTracking"))||null,a.iconView=Ge(Qe(t,"IconViewTracking"))||null;var s=Xe(t,"xPosition").toLowerCase(),o=Xe(t,"yPosition").toLowerCase(),l={};return"left"===s||"right"===s?l[s]=0:l.left=parseInt(s,10)||0,"top"===o||"bottom"===o?l[o]=0:l.top=parseInt(o,10)||0,l.width=parseInt(Xe(t,"width"),10)||0,l.height=parseInt(Xe(t,"height"),10)||0,e.push({program:Xe(t,"program"),style:l,apiFramework:Xe(t,"apiFramework"),offset:Xe(t,"offset")||"00:00:00",duration:Xe(t,"duration")||null,clickThrough:Ge(Qe(t,"IconClickThrough")),trackers:a,resource:{resourceType:r,resourceSource:n}}),e}),t.icons||[])}(r,a)}else if(s){var m=Ge(Qe(s,"NonLinearClickThrough")),v=Ue(s,"NonLinearClickTracking");Ve.call(v,(function(e){Je(n,"click",Ge(e))})),m&&(a.clickthrough=m),function(e,t){var i=[],r=Qe(e,"StaticResource");r&&!t.media&&(i.push({type:Xe(r,"creativeType"),file:Ge(r),adType:Xe(Qe(e,"NonLinear"),"apiFramework")||"static",minDuration:Xe(Qe(e,"NonLinear"),"minSuggestedDuration")||"00:00:00"}),t.media=i)}(e,a)}else!function(e,t){var i=Ue(Qe(e,"CompanionAds"),"Companion"),r=t.companions?t.companions:[];Ve.call(i,(function(e){var t,i,n=Qe(e,"StaticResource"),a=Qe(e,"IFrameResource"),s=Qe(e,"HTMLResource"),o={};if(n)t=Xe(n,"creativeType"),i=Ge(n);else if(a)t="iframe",i=Ge(a);else{if(!s)return;t="html",i=Ge(s)}var l=Ue(Qe(e,"TrackingEvents"),"Tracking");Ve.call(l,(function(e){var t=Xe(e,"event");Je(o,t,Ge(e))}));var d=Ge(Qe(e,"CompanionClickThrough"));r.push({width:parseInt(Xe(e,"width"),10),height:parseInt(Xe(e,"height"),10),type:t,source:i,trackers:o,clickthrough:d})})),t.companions=r}(e,a)})),a}(h,e,this.utils),$e(h,"Impression",r.trackers),$e(h,"Error",r.trackers),$e(h,"NotViewable",r.trackers),$e(h,"Viewable",r.trackers),function(e){var t={};e.media&&e.media.forEach((function(e){var i=e.type,r="application/x-mpegURL"===i||"vnd.apple.mpegURL"===i;"vpaid"===e.adType.toLowerCase()||r||(t[i]=t[i]||0,t[i]++)}));e.mediaFileCompliance=!0,Object.keys(t).forEach((function(i){var r=t[i];r<3&&(e.mediaFileCompliance=!1,e.nonComplianceReasons=e.nonComplianceReasons||[],e.nonComplianceReasons.push(i+" has only "+r+" qualities"))}))}(r),d&&(r.wrappedURI=Ge(Qe(d,"VASTAdTagURI"))||Ge(Qe(d,"VASTAdTagURL")),r.followAdditionalWrappers=JSON.parse(Xe(d,"followAdditionalWrappers")),r.allowMultipleAds=JSON.parse(Xe(d,"allowMultipleAds")),r.fallbackOnNoAd=JSON.parse(Xe(d,"fallbackOnNoAd"))),s=r,o=B({},i),Object.keys(s).forEach((function(e){var t=s[e];Array.isArray(o[e])?o[e]=o[e].concat(t):"object"==typeof o[e]&&null!==o[e]?o[e]=B(o[e],t):o[e]=t})),r=o):this.throwError(303,"No ads",10303),r},t.parseExtensions=function(e){var t={},i=Qe(e,"Extensions");if(!i||!i.childNodes||!i.childNodes.length)return null;for(var r=0;r<i.childNodes.length;r++){var n=i.childNodes[r];if("Extension"===n.nodeName){var a=Xe(n,"type");t[a]=t[a]?t[a].concat(i.childNodes[r]):[i.childNodes[r]]}}return t},t.throwError=function(e,t,i){throw this._error=new Error(t),this._error.code=e,this._error.adErrorCode=i||1e4+e,this._error},e}();function Ue(e,t,i){var r=[];return e&&(r=e.getElementsByTagName(t),i&&r&&0===r.length&&(r=e.getElementsByTagName(i+":"+t))),r}function Qe(e,t){if(e){var i=e.getElementsByTagName(t);if(i)return i[0]}return null}function We(e,t,i,r){var n=[];return e||t?n=t.getElementsByTagNameNS?t.getElementsByTagNameNS(e,i):t.getElementsByTagName(r+":"+i):n}function Xe(e,t){return e?e.getAttribute(t):null}function ze(e,t){var i=Xe(t,"event");"progress"===i&&(i=i+"_"+Xe(t,"offset"));Je(e,i,Ge(t))}function Ge(e){if(e){var t=e.textContent||e.text;if(t)return t.trim()}return""}function Je(e,t,i){e[t]||(e[t]=[]),i&&(e[t].push(i),Ye(i))}function $e(e,t,i){var r=Ue(e,t);Me.call(r,(function(e){Je(i,t.toLowerCase(),Ge(e))}))}var Ye=function(e){(e.indexOf("[REGULATIONS]")>=0||e.indexOf("[GDPRCONSENT]")>=0)&&(Pe().catch(Be),Ye=Be)};function Ke(e){e.onload=e.onreadystatechange=e.onerror=null,"abort"in e&&e.abort()}var Ze=function(){function e(e,t){this.adRules=e,this.utils=t,this.preRoll=null,this.vmap=null,this.postRoll=null,this.midRolls=[],this.playedMidRolls=[],this.duration=0,this._vmapPromise=null,this._vmapXHR=null}var t=e.prototype;return t.load=function(e,t,i,r){var n=this;if(this._vmapPromise)return this._vmapPromise;null!==this._vmapXHR&&(Ke(this._vmapXHR),this._vmapXHR=null);var a=xe(this.getVMAP(),e,t,i,r);return i===te?(this._vmapPromise=a.then((function(e){n.setPreRoll({_adQueue:[e]})})),this._vmapPromise):(this._vmapPromise=a.then((function(t){return new Promise((function(i,a){n._vmapXHR=e.utils.ajax({url:t,withCredentials:r.withCredentials,retryWithoutCredentials:!0,requireValidXML:!0,timeout:n.requestTimeout},i,(function(e,t,i,r){return a(r)}))})).then((function(r){return n._vmapXHR=null,e.trigger("adLoadedXML",{client:i,tag:t,xml:r.responseXML}),Le(r.responseXML,n,e.utils).map((function(e){return B(e,{vmap:t})}))})).catch((function(i){n._vmapXHR=null;var r={id:ne,vmap:t};if(i.message)B(r,{message:"VMAP Schema Error: "+i.message,code:1002,adErrorCode:i.adErrorCode||11002});else{var a={1:{code:1007,message:"Timeout"},602:{code:1e3,message:"Invalid XML"},default:{code:1008,message:e.getConfig().localization.errors[i.key]}},s=a[i.code]||a.default;e.utils.log(s.message),B(r,{message:"Error Loading VMAP Schedule",code:s.code,adErrorCode:s.code+1e4})}throw r}))})),this._vmapPromise)},t.canWaterfall=function(e){return e._adQueue&&e._waterfallIndex+1<e._adQueue.length},t.getPreRoll=function(e){return e&&"none"===this.adRules.startOnSeek?null:et(this.preRoll,this.requestTimeout,this.creativeTimeout)},t.getPostRoll=function(e){var t=et(this.postRoll,this.requestTimeout,this.creativeTimeout);return this.adRules.timeBetweenAdsAllowsAdPlayback(t,e)?t:null},t.getMidRollAtIndex=function(e){return et(this.midRolls[e],this.requestTimeout,this.creativeTimeout)},t.getLastMidRollIndexBetweenTime=function(e,t,i){if(e>t)return null;this.sort(i);for(var r=this.midRolls.length;r--;){var n=this.midRolls[r],a=tt(this.midRolls[r]._offSet,i);if(e>=a)return null;if(t>=a){var s=et(n,this.requestTimeout,this.creativeTimeout);if(!this.adRules.timeBetweenAdsAllowsAdPlayback(s))return null;if(!this.adRules.timeBetweenAds){if(this.playedMidRolls.indexOf(r)>=0)return null;this.playedMidRolls.push(r)}return r}}return null},t.peek=function(e,t,i){if(this.midRolls.length>this.playedMidRolls.length){this.sort(i);for(var r=0;this.midRolls[r];){var n=tt(this.midRolls[r]._offSet,i);if(n>=e&&-1===this.playedMidRolls.indexOf(r)){var a=be()+1e3*(n-e);return n<=t&&this.adRules.timeBetweenAdsAllowsAdPlayback(null,a)?r:null}r+=1}}var s=be()+1e3*(i-e);return this.postRoll&&t>=i&&this.adRules.timeBetweenAdsAllowsAdPlayback(null,s)?-1:null},t.getNextMidrollIndex=function(e,t,i){if(this.adRules.timeBetweenAds||this.adRules.startOnSeek)return this.getLastMidRollIndexBetweenTime(e,t,i);if(this.midRolls.length>this.playedMidRolls.length){var r=this.getClosestIndex(t,i);if(r>=0&&this.playedMidRolls.indexOf(r)<0)return this.playedMidRolls.push(r),r}return null},t.getMidRolls=function(){var e=this;return this.midRolls.map((function(t){return et(t,e.requestTimeout,e.creativeTimeout)}))},t.reset=function(){null!==this._vmapXHR&&(Ke(this._vmapXHR),this._vmapXHR=null),this.playedMidRolls=[],this.duration=0},t.setPreRoll=function(e){this.resetBreakId(e),this.preRoll=e},t.addMidRoll=function(e){this.resetBreakId(e),this.midRolls.push(e),this.duration=0},t.setPostRoll=function(e){this.resetBreakId(e),this.postRoll=e},t.sort=function(e,t){(!e||e<1)&&(e=1),(this.duration!==e||t)&&(this.duration=e,this.midRolls.sort((function(t,i){return tt(t._offSet,e)-tt(i._offSet,e)})),function(e,t){for(var i=0;i<e.length;i++){var r=e[i];t?r._vmap.item=i+1:(r._adbreak={item:i+1,breakid:r._breakId},r._pod?r._adbreak.pod=r._pod:r._adbreak.tags=r._adQueue)}}(this.getAllAds(),t))},t.getAllAds=function(){var e=this.preRoll?[this.preRoll]:[],t=this.postRoll?[this.postRoll]:[];return e.concat(this.midRolls,t)},t.setVMAP=function(e){this.vmap=e},t.isVMAP=function(){return!!this.vmap},t.getVMAP=function(){return this.vmap},t.getClosestIndex=function(e,t){this.sort(t);for(var i=this.midRolls.length;i--;)if(e>=tt(this.midRolls[i]._offSet,t))return i;return-1},t.resetBreakId=function(e){e.adBreakId=this.utils.genId(12)},t.resetAllBreakIds=function(){var e=this;this.getAllAds().forEach((function(t){e.resetBreakId(t)}))},t.destroy=function(){this.reset(),this.adRules.destroy()},e}();function et(e,t,i){var r;if(null!==e)return Object.keys(e).forEach((function(t){var i=e[t];(r=r||{})[t]="_adQueue"===t||"_pod"===t?i.slice():i})),r?(r.requestTimeout=t,r.creativeTimeout=i,r._errors=[],r._waterfallIndex=0,r._adPodIndex=0,r):void 0}function tt(e,t){return"%"===e.toString().slice(-1)?t*parseFloat(e.slice(0,-1))/100:parseFloat(e)}var it=function(){function e(e){this.utils=e}var t=e.prototype;return t.getSchedule=function(e,t){var i=new Ze(t,this.utils);if(i.requestTimeout=nt(e.requestTimeout,5e3),i.creativeTimeout=nt(e.creativeTimeout,5e3),e.tag)i.setPreRoll({_offSet:"pre",_adQueue:rt(e.tag),_waterfallIndex:0});else if("string"==typeof e.vastxml)i.setPreRoll({_offSet:"pre",_adXML:e.vastxml});else{if("string"==typeof e.schedule)return i.setVMAP(e.schedule),i;if("string"==typeof e.adschedule)return i.setVMAP(e.adschedule),i;!function(e,t,i){var r=t.schedule||t.adschedule;if(!r)return;var n={};Object.keys(r).forEach((function(e){var t=r[e];t.ad&&(B(t,t.ad),delete t.ad);var a=function(e,t){if("start"===e||"0%"===e||!e&&0!==e)return"pre";if("end"===e||"100%"===e)return"post";if("pre"===e||"post"===e||(e+"").indexOf("%")>=0)return e;var i=t.seconds(e);if("number"==typeof i)return i;return!1}(t.offset,i),s=nt(t.requestTimeout,se),o=nt(t.creativeTimeout,oe),l=n[a];if(l){if("nonlinear"===t.type)return;"nonlinear"===l._type&&(l=null)}var d=n[a]=l||{_offSet:a,_type:t.type,_breakId:e,adBreakId:i.genId(12),requestTimeout:s,creativeTimeout:o};!1===a&&i.log("Error: ad offset format not supported",a);var h=t.skipoffset;if(void 0!==h&&void 0===d.skipoffset&&(d.skipoffset=h),"string"==typeof t.adm)d.adm=t.adm;else if(t.pod){var u=d._pod||[];d._pod=u.concat(t.pod)}else if(t.tag){var c=function(e,t){if(!t)return e;var i=e.indexOf("?")>=0?"&":"?",r=e.indexOf(ae),n=ae.length,a="",s="";if(Object.keys(t).forEach((function(e){var i=t[e];a=""+a+s+e+"="+i,s="&"})),a=encodeURIComponent(a),r>=0){var o=e.substr(0,r+n),l=e.substr(r+n);return""+o+a+"%26"+l}return""+e+i+ae+a}(t.tag,t.custParams);d._adQueue&&(d._pod=[d._adQueue[0]],delete d._adQueue),d._pod?d._pod.push(rt(c)[0]):d._adQueue=rt(c)}else{if("string"!=typeof t.vastxml)return void i.log("Error: no ad tag provided");d._adXML=t.vastxml}})),Object.keys(n).forEach((function(i){var r=n[i];switch(r.skipoffset=void 0!==r.skipoffset?r.skipoffset:t.skipoffset,i){case"pre":e.setPreRoll(r);break;case"post":e.setPostRoll(r);break;default:e.addMidRoll(r)}}))}(i,e,this.utils)}return i.sort(),i},t.getOptParams=function(e,t){var i={cuetext:t.cuetext,dynamicMessage:t.admessage,loadingAd:t.loadingAd,podMessage:t.podmessage,skipoffset:e.skipoffset,skipMessage:t.skipmessage,skipText:t.skiptext,omidAccessMode:e.omidAccessMode||"full",omidSupport:e.omidSupport||"auto",allowedOmidVendors:e.allowedOmidVendors||[],vpaidcontrols:e.vpaidcontrols||!1,conditionaladoptout:e.conditionaladoptout||!1,requestFilter:e.requestFilter,trackingFilter:e.trackingFilter,withCredentials:void 0===e.withCredentials||e.withCredentials,extensions:"[object Object]"===Object.prototype.toString.call(e.extensions)?e.extensions:{}},r=e.companiondiv;return r&&(i.companion={id:r.id,height:r.height,width:r.width}),i},t.getAdRules=function(e){var t=e.rules||{},i=parseInt(t.frequency,10);return{startOn:t.startOn||1,frequency:isNaN(i)?1:i,timeBetweenAds:t.timeBetweenAds||0,startOnSeek:t.startOnSeek||null,deferAds:t.deferAds||null}},e}();function rt(e){return Array.isArray(e)?e.slice(0):[e]}function nt(e,t){return 0===e?1/0:e||t}function at(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var st=function(){function e(e,t){this.player=e,this.options=t,this.client=t.client,this.ignoreStartOnSeek=!1,this.reset(),t.timeBetweenAds&&e.on({adBreakStart:this.handleAdBreakStart,adSkipped:this.handleAdSkipped,adComplete:this.handleAdComplete,adBreakEnd:this.handleAdBreakEnd,destroyPlugin:this.destroy},this)}var t,i,r,n=e.prototype;return n.shouldDeferAds=function(){return this.options.deferAds&&!this.player.getConfig().activeTab},n.clearStartOnSeek=function(){this.ignoreStartOnSeek=!0},n.sendAdBreakIgnored=function(e,t){e&&this.player.trigger(le,function(e,t){var i={};return e&&(i={id:e._breakId,tag:e._adQueue&&e._adQueue.length>0?e._adQueue[0]:e._adXML,offset:e._offSet}),B(i,{timeSinceLastAd:t,type:le})}(e,t,this.client))},n.rulesAllowAdPlayback=function(e){var t=this.options,i=0===t.frequency&&1===e,r=e>=t.startOn&&(e-t.startOn)%t.frequency==0;return i||r},n.handleAdBreakStart=function(){this.adSkipped=!1,this.adComplete=!1},n.handleAdComplete=function(){this.adComplete=!0},n.handleAdSkipped=function(){this.adSkipped=!0},n.handleAdBreakEnd=function(){!this.adSkipped&&this.adComplete&&(this.recentCompletedAdTime=be())},n.timeBetweenAdsAllowsAdPlayback=function(e,t){if(void 0===t&&(t=be()),this.options.timeBetweenAds){var i=(t-this.recentCompletedAdTime)/1e3;if(i<this.options.timeBetweenAds)return this.sendAdBreakIgnored(e,i),!1}return!0},n.reset=function(){this.ignoreStartOnSeek=!1,this.recentCompletedAdTime=0},n.destroy=function(){this.player.off(null,null,this)},t=e,(i=[{key:"timeBetweenAds",get:function(){return this.options.timeBetweenAds}},{key:"startOnSeek",get:function(){return this.ignoreStartOnSeek?null:this.options.startOnSeek}}])&&at(t.prototype,i),r&&at(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),ot=function(){},lt=function(){function e(e,t,i,r,n){B(this,e.Events),this.client="shared",this.player=e,this.item=i,this.config=r,this.casting=n;var a=e.utils,s=new it(a);this.adRules=new st(e,s.getAdRules(r)),"string"==typeof t?(this.schedule=new Ze(this.adRules,a),this.schedule.setPreRoll({tag:t})):(this.schedule=t,t.resetAllBreakIds()),this.vmapPromise=null,this.lastTimeEvent=null,this.prerollPromise=null,this.midrollPromise={},this.postrollPromise=null,this.next=null,this.nextPlaylistItemPromise=null,this.relatedNextUp=null,this.bidding=e.getPlugin("bidding"),this.bids=[],this.bidsPromises=[],this.bidsPromise=null,this._events=[]}var t=e.prototype;return t.attachListeners=function(){this.player.on({all:this.onAll,beforePlay:this.checkPreroll,relatedReady:this.relatedReady,cast:this.onCast,destroyBidding:this.destroyBids},this)},t.onAll=function(e,t){"time"===e?this.checkMidrolls(t):"beforeComplete"===e&&this.checkPostrolls(t)},t.relatedReady=function(){var e=this;if(this.config.preloadAds){var t=this.player.getPlugin("related");t&&t.on("nextUp",(function(t){t&&"discovery"===t.mode&&(e.relatedNextUp=t)}))}},t.onCast=function(e){this.casting=!!e.active},t.init=function(e,t){var i=this;if(void 0===e&&(e=null),this.schedule.isVMAP()&&(t.requestTimeout=this.schedule.requestTimeout,t.creativeTimeout=this.schedule.creativeTimeout,this.vmapPromise=this.schedule.load(this.player,this.item,this.client,t)),this.bidsPromise=this.vmapPromise||Promise.resolve(),this.bidsPromise=null!==e?this.bidsPromise.then((function(){if(!i.isDestroyed()){if(i.bidding)return i.createBidsPromise(e,t);var r=function(e,t,i){var r=Ie(e,t,i);return B(r,{message:"Ad Error: bidding plugin unavailable",code:900,adErrorCode:60008}),r}(i,null,t);i.player.trigger(de,r)}})).catch(ot):this.bidsPromise.catch(ot),this.config.preloadAds)if(1===t.playlistItemEventCount){var r=this.player.getConfig().autostart;!1===r||"viewable"===r&&0===this.player.getViewable()?this.loadPreroll(t).catch((function(e){return i.isDestroyed()?null:i.enqueueAdEvent(de,e,{preload:!0})})):this.player.once("autostartNotAllowed",(function(){i.loadPreroll(t).catch((function(e){return i.isDestroyed()?null:i.enqueueAdEvent(de,e,{preload:!0})}))}))}else t.preloadPreroll&&this.loadPreroll(t).catch((function(e){return i.isDestroyed()?null:i.enqueueAdEvent(de,e,{preload:!0})}));return this.bidsPromise},t.createBidsPromise=function(e,t){var i=this,r=this.player,n=parseInt(e.bidOnBreaks,10);return n=n>0?n:1/0,this.bids=this.schedule.getAllAds().slice(0,n).map((function(n){var a=i.getAdIds(n).adPlayId,s=r.getConfig(),o=i.config.skipoffset,l=null!=o&&o>=0,d=_e(r,i.item),h={id:a,offset:e.offset,jwpseg:d,placement:Ee(s),tag:n._adQueue?n._adQueue[0]:n._currentTag,adClient:i.client};i.client===ee&&(h.skipoffset=l?o:-1);var u=i.bidding.createNewBid(h,{getURLParts:Te});i.player.trigger("adBidRequest",Ie(i,n,B({jwpseg:d},t))),u.init();var c=u.start().then((function(e){var r=e.result;if(!i.isDestroyed()){var a=Promise.resolve();return r&&!r.error&&(n.jwpseg=d,r.adm?(n._adXML=r.adm,n._adQueue&&n._adQueue.length&&n._adQueue.unshift(r.adm)):r.tag&&(a=xe(r.tag,i.player,i.item,i.client,{},n).then((function(e){i.client===ee?(n._adQueue=n._adQueue||[],n._adQueue.unshift(e)):n._adQueue=[e]})))),i.player.trigger("adBidResponse",Ie(i,n,t)),a}}));return i.bidsPromises.push(c),u})),Promise.all(this.bidsPromises)},t.checkPreroll=function(e){var t=this;if(this.bidTimeoutStarted||(this.bidTimeoutStarted=!0,this.bids.forEach((function(e){return e.timeout()}))),!(this.casting||this.preRollPlayed||this.adRules.shouldDeferAds())){this.preRollPlayed=!0;var i=(e||{}).startTime||this.player.getPosition();this.lastTimeEvent=i||this.lastTimeEvent;var r=this.schedule.getPreRoll(i);if(r||this.vmapPromise){(null!==this.vmapPromise||r&&"nonlinear"!==r._type)&&this.startBlocking(),this.bidsPromise.then((function(){if(!t.isDestroyed()){var e=t.schedule.getPreRoll(i);e&&"nonlinear"!==e._type&&t.triggerAdBreakEvents(e,"pre")}})),i?"none"===this.adRules.startOnSeek&&(this.prerollPromise=null):this.adRules.clearStartOnSeek();var n=e&&e.playReason?e.playReason:"external";this.playPreroll({adBlock:this.adBlockErrorDetected,startTime:i,reason:n})}}},t.checkMidrolls=function(e){var t=this;if(!this.casting&&0!==e.duration&&!this.adRules.shouldDeferAds()){var i=this.schedule.getNextMidrollIndex(this.lastTimeEvent,e.position,e.duration);if(this.lastTimeEvent=e.position,null!==i){var r=this.schedule.getMidRollAtIndex(i);"nonlinear"!==r._type&&(this.startBlocking(),this.triggerAdBreakEvents(r,"mid")),this.playMidrollAtIndex(i,{adBlock:this.adBlockErrorDetected})}else if(!this.preRollPlayed&&this.schedule.getClosestIndex(e.position,e.duration)<0)this.checkPreroll(e);else if(this.config.preloadAds){var n=e.position+5,a=this.schedule.peek(e.position,n,e.duration);if(null!==a&&a>=0)this.loadMidrollAtIndex(a,{adBlock:this.adBlockErrorDetected,preload:!0}).catch(ot);else if(-1===a){var s=be()+1e3*(e.duration-e.position);this.loadPostroll({adBlock:this.adBlockErrorDetected,preload:!0,startTime:s}).catch(ot)}else if(null===this.next&&null===this.nextPlaylistItemPromise&&n>e.duration){var o=this.player.getPlaylistIndex()+1,l=this.player.getPlaylistItem(o);if(this.nextPlaylistRelated=!!this.relatedNextUp,l||this.relatedNextUp){var d=this.relatedNextUp?-1:o;this.nextPlaylistItemPromise=Promise.resolve(this.player.getPlaylistItemPromise(d)).then((function(){t.isDestroyed()||(t.trigger("preloadNext",{item:t.player.getPlaylistItem(o)||t.relatedNextUp,index:d}),t.relatedNextUp=null,t.nextPlaylistItemPromise=null)})).catch(ot)}}}}},t.checkPostrolls=function(e){if(!(this.casting||this.adRules.shouldDeferAds()||this.isDestroyed())){var t=this.schedule.getPostRoll();t&&("nonlinear"!==t._type&&(this.startBlocking(),this.triggerAdBreakEvents(t,"post")),this.playPostroll(e))}},t.getAdIds=function(e,t){var i=void 0===t?{}:t,r=i.tagIndex,n=i.podIndex,a=e.adRequestIds&&void 0!==r?e.adRequestIds[r]:null;if(!a){var s="p"+(n||e._adPodIndex||0)+"w"+(e._waterfallIndex||0);"p0w0"===s?a=e.adBreakId:(e.adPlayIds=e.adPlayIds||{},a=e.adPlayIds[s]=e.adPlayIds[s]||this.player.utils.genId(12))}return{adBreakId:e.adBreakId,adPlayId:a}},t.loadPreroll=function(e){var t=this;return void 0===e&&(e={}),this.prerollPromise||(this.prerollPromise=this.bidsPromise.then((function(){if(!t.isDestroyed()){var i=t.schedule.getPreRoll(e.startTime);return i?(i._position="pre",i._preload=!0,t.loadAd(i,e)):void 0}}))),this.prerollPromise},t.loadMidrollAtIndex=function(e,t){var i=this;return this.midrollPromise[e]||(this.midrollPromise[e]=this.bidsPromise.then((function(){if(!i.isDestroyed()){var r=i.schedule.getMidRollAtIndex(e);return r?(r._position="mid",r._preload=!0,i.loadAd(r,t)):void 0}}))),this.midrollPromise[e]},t.loadPostroll=function(e){var t=this;return void 0===e&&(e={}),this.postrollPromise||(this.postrollPromise=this.bidsPromise.then((function(){if(!t.isDestroyed()){var i=t.schedule.getPostRoll(e.startTime);return i?(i._position="post",i._preload=!0,t.loadAd(i,e)):void 0}}))),this.postrollPromise},t.playPreroll=function(e){var t=this;this.prerollPromise?this.playPreloadedPromise(this.prerollPromise,e):this.bidsPromise.then((function(){if(!t.isDestroyed()){var i=t.schedule.getPreRoll(e.startTime);i?(i._position="pre",t.startAdBreak(i,e)):t.stopBlocking()}}))},t.playMidrollAtIndex=function(e){var t=this;this.midrollPromise[e]?this.playPreloadedPromise(this.midrollPromise[e]):this.bidsPromise.then((function(){var i=t.schedule.getMidRollAtIndex(e);i&&(i._position="mid",t.startAdBreak(i))}))},t.playPostroll=function(e){var t=this;this.postrollPromise?this.playPreloadedPromise(this.postrollPromise):this.bidsPromise.then((function(){var i=t.schedule.getPostRoll();i&&(i._position="post",t.startAdBreak(i,e))}))},t.isDestroyed=function(){return null===this.player},t.destroy=function(){this.destroyBids(),this.player.off(null,null,this),this.player=null},t.destroyBids=function(){this.bids.forEach((function(e){return e.stop()})),this.bidsPromises=[],this.bids=[]},t.enqueueAdEvent=function(e,t,i){this._events.push({type:e,event:t}),i.preload||this.dequeueAdEvents()},t.dequeueAdEvents=function(){},t.triggerAdBreakEvents=function(){},t.startBlocking=function(){},t.stopBlocking=function(){},t.loadAd=function(){},t.playPreloadedPromise=function(){},t.startAdBreak=function(){},e}(),dt=function(){function e(e,t,i,r,n,a,s){B(this,e.Events),this.player=e,this.startingSize=e.getWidth()*e.getHeight();var o=a.allowedOmidVendors;try{var l=[];r.forEach((function(e){var i=e.javaScriptResource,r=e.vendor,n=e.verificationParameters,d=e.trackers;o.length&&o.indexOf(r)<0?s("verificationNotExecuted",d.verificationNotExecuted,{"[REASON]":1}):i?i.url?l.push(new t.VerificationScriptResource(i.url,r,n,a.omidAccessMode)):s("verificationNotExecuted",d.verificationNotExecuted,{"[REASON]":3}):s("verificationNotExecuted",d.verificationNotExecuted,{"[REASON]":2})}));var d=new t.Partner("JWPlayer",e.version),h=new t.Context(d,l,location.href);h.setVideoElement(i),h.underEvaluation=!0,h.setServiceWindow(window);var u=this.adSession=new t.AdSession(h);if(!u.isSupported())return;this.adEvents=new t.AdEvents(u),this.mediaEvents=new t.MediaEvents(u),n&&u.setCreativeType("video"),u.start()}catch(e){return console.warn(e),null}}var t=e.prototype;return t.resetResizeTimeout=function(){var e=this;clearTimeout(this.resizeTimer),this.isFullscreen||(this.resizeTimer=setTimeout((function(){if(e.mediaEvents){var t=e.player.getWidth(),i=e.player.getHeight();t*i>e.startingSize?e.mediaEvents.playerStateChange("expanded"):t*i<e.startingSize?e.mediaEvents.playerStateChange("collapsed"):e.mediaEvents.playerStateChange("normal")}}),250))},t.trackEvent=function(e){var t,i;if(this.adEvents&&this.mediaEvents)try{for(var r=arguments.length,n=new Array(r>1?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];switch(e){case v:this.adEvents.loaded();break;case"click":this.mediaEvents.adUserInteraction("click");break;case"close":this.finishSession();break;case"complete":this.mediaEvents.complete(),this.finishSession();break;case"firstQuartile":this.mediaEvents.firstQuartile();break;case"fullscreen":this.isFullscreen=n[0],this.resetResizeTimeout(),this.isFullscreen&&this.mediaEvents.playerStateChange("fullscreen");break;case"impression":(t=this.mediaEvents).start.apply(t,n),this.adEvents.impressionOccurred(),this.startingSize=this.player.getWidth()*this.player.getHeight(),this.isFullscreen=this.player.getFullscreen();break;case"midpoint":this.mediaEvents.midpoint();break;case"mute":this.mediaEvents.volumeChange(0);break;case"pause":this.mediaEvents.pause();break;case"resize":this.resetResizeTimeout();break;case"resume":this.mediaEvents.resume();break;case"skip":this.mediaEvents.skipped(),this.finishSession();break;case"thirdQuartile":this.mediaEvents.thirdQuartile();break;case"unmute":this.mediaEvents.volumeChange(this.player.getVolume()/100);break;case"volume":(i=this.mediaEvents).volumeChange.apply(i,n);break;case"bufferStart":this.mediaEvents.bufferStart();break;case"bufferFinish":this.mediaEvents.bufferFinish()}}catch(e){console.warn(e),this.adEvents=this.mediaEvents=null}},t.finishSession=function(){this.adSession&&(this.adSession.finish(),this.adSession=null,this.adEvents=null,this.mediaEvents=null)},e}(),ht=null,ut=null,ct=function(e){return function(e){if(ut)return ut;var t=["//","ssl.p.jwpcdn.com/player/lib/omid/v/1.3.15/omweb-v1.js"];"file:"===document.location.protocol&&t.unshift("https:");var i=new(0,e.scriptloader)(t.join(""));return ut=i.load()}(e).then((function(){return function(e){if(ht)return ht;if(window.OmidSessionClient&&window.OmidSessionClient.default)return ht=Promise.resolve();var t=["//","ssl.p.jwpcdn.com/player/lib/omid/v/1.3.15/omid-session-client-v1.js"];"file:"===document.location.protocol&&t.unshift("https:");var i=new(0,e.scriptloader)(t.join(""));return ht=i.load()}(e)}))},pt=[],ft=function(){function e(e,t,i,r,n,a){var s=this,o=e.adServingId,l=e.adVerifications,d=e.linear,h=t||{};this.adServingId=o,this.map=h,this.omidDeferredEvents=[],a&&l&&"disabled"!==n.omidSupport&&(a.on(v,(function(){a.off(null,null,s),s.trackOmidEvent(v)}),this),ct(r.utils).then((function(){var e=window.OmidSessionClient.default,t=a.getMediaElement();s.omidTracker=new dt(r,e,t,l,d,n,s.trackPingsByUrl.bind(s)),s.omidDeferredEvents.forEach((function(e){var t=e.type,i=e.args;s.trackOmidEvent.apply(s,[t].concat(i))})),s.omidDeferredEvents=[]}))),this.debugTrackFn=i,this.trackerPlayerUtils=function(e){return{getPosition:function(){return e.getPosition()},getFile:function(){return e.getPlaylistItem().file},getPlacement:function(){return J(e.getConfig())},getUserAgent:function(){return navigator.userAgent}}}(r),this.trackingFilter=n.trackingFilter,this.lastQuartile=0,this.progressEvents=[],this.breakStarted=!1,this.started=!1,this.firedError=!1,this.hasComp=!1,this.buffering=!1,Object.keys(h).forEach((function(e){if(Object.prototype.hasOwnProperty.call(h,e)&&0===e.indexOf("progress")){var t=""+e.split("_")[1],i={key:e,offset:t,tracked:!1,percentage:!1};/^\d+%$/.test(t)?(i.percentage=!0,i.offset=parseFloat(t)):i.offset=r.utils.seconds(t),s.progressEvents.push(i)}})),this.setFactories()}var t=e.prototype;return t.getUrls=function(e){return Object.prototype.hasOwnProperty.call(this.map,e)?this.map[e]:[]},t.addUrl=function(e,t){Object.prototype.hasOwnProperty.call(this.map,e)||(this.map[e]=[]),this.map[e].push(t)},t.trackPingsByUrl=function(e,t,i){void 0===i&&(i={});var r=this.trackingFilter,n=[],a=[],s=[];if(t.length){i=this.replaceMacros(i),t.forEach((function(e){if(e){if(Object.keys(i).forEach((function(t){e=e.replace(t,i[t])})),r&&!1===r(e))return void a.push(e);var t=new Image;t.src=e,n.push(e),s.push(t)}})),Array.prototype.push.apply(pt,s);for(var o=pt.length;o--&&(pt[o].width||pt[o].complete);)pt.length=o}"function"==typeof this.debugTrackFn&&this.debugTrackFn({type:"ping",data:{pingType:e,urls:n,filteredUrls:a,images:s}})},t.trackPings=function(e,t){var i=this.getUrls(e);this.trackPingsByUrl(e,i,t)},t.trackOmidEvent=function(e){for(var t,i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];this.omidTracker?(t=this.omidTracker).trackEvent.apply(t,[e].concat(r)):this.omidDeferredEvents.push({type:e,args:r})},t.replaceMacros=function(e){var t,i,r,n,a,s,o,l=Ae,d=l.gdprApplies,h=l.consentData;return e["[ADSERVINGID]"]=encodeURIComponent(this.adServingId||""),e["[ASSETURI]"]=encodeURIComponent(this.trackerPlayerUtils.getFile()),e["[CACHEBUSTING]"]=Math.random().toString().slice(2,10),e["[CONTENTPLAYHEAD]"]=encodeURIComponent((t=this.trackerPlayerUtils.getPosition(),i=("0"+Math.floor(t/3600)).slice(-2),r=("0"+Math.floor((t-3600*i)/60)).slice(-2),i+":"+r+":"+("0"+Math.floor(t-3600*i-60*r)).slice(-2)+"."+(t%1).toFixed(3).toString().slice(2,5))),e["[DEVICEUA]"]=encodeURIComponent(this.trackerPlayerUtils.getUserAgent()),e["[GDPRCONSENT]"]=h,e["[PAGEURL]"]=encodeURIComponent(G().url),e["[PLACEMENTTYPE]"]=this.trackerPlayerUtils.getPlacement(),e["[REGULATIONS]"]=d?"gdpr":"",e["[TIMESTAMP]"]=encodeURIComponent((n=new Date,a=n.getTime(),s=n.getTimezoneOffset()/60,o=6e4*n.getTimezoneOffset(),new Date(a-o).toISOString().slice(0,-1)+(s>0?"-":"+")+("0"+s).slice(-2))),e},t.start=function(){this.started=!0,this.trackPings("start")},t.breakStart=function(){this.breakStarted=!0,this.trackPings("breakStart")},t.time=function(e,t){if(!(t<=1)){for(var i=(4*e+.05)/t|0;i>this.lastQuartile&&this.lastQuartile<3;)this.lastQuartile++,1===this.lastQuartile?(this.trackPings("firstQuartile"),this.trackOmidEvent("firstQuartile")):2===this.lastQuartile?(this.trackPings("midpoint"),this.trackOmidEvent("midpoint")):3===this.lastQuartile&&(this.trackPings("thirdQuartile"),this.trackOmidEvent("thirdQuartile"));this.trackProgress(e,t)}},t.trackProgress=function(e,t){for(var i=this.progressEvents.length;i--;){var r=this.progressEvents[i];if(!r.tracked){var n=r.offset;r.percentage&&(n=t*n/100),e>=n&&(r.tracked=!0,this.trackPings(r.key))}}},t.error=function(e){void 0===e&&(e=900),this.firedError=!0;var t={};t["[ERRORCODE]"]=e,this.trackPings("error",t)},t.factory=function(e){var t=this;return function(){if(t.trackPings(e),"fullscreen"!==e){for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];t.trackOmidEvent.apply(t,[e].concat(r))}}},t.setFactories=function(){this.creativeView=this.factory("creativeView"),this.click=this.factory("click"),this.skip=this.factory("skip"),this.complete=this.factory("complete"),this.pause=this.factory("pause"),this.resume=this.factory("resume"),this.mute=this.factory("mute"),this.unmute=this.factory("unmute"),this.fullscreen=this.factory("fullscreen"),this.expand=this.factory("expand"),this.collapse=this.factory("collapse"),this.acceptInvitation=this.factory("acceptInvitation"),this.close=this.factory("close"),this.rewind=this.factory("rewind"),this.impression=this.factory("impression"),this.viewable=this.factory("viewable"),this.notViewable=this.factory("notviewable"),this.breakEnd=this.factory("breakEnd")},e}(),mt=function(e,t){var i=[];return t.forEach((function(t){var r,n;e.companions&&(t.companions=(t.companions?t.companions:[]).concat(e.companions)),e.trackers&&(t.trackers=(r=t.trackers,n=e.trackers,r=r||{},Object.keys(n).forEach((function(e){var t=n[e];r[e]?r[e]=r[e].concat(t):r[e]=t})),r)),e.sequence&&(t.sequence=e.sequence),e._currentTag&&(t._currentTag=e._currentTag),e.adVerifications&&(t.adVerifications=(t.adVerifications?t.adVerifications:[]).concat(e.adVerifications)),i.push(t)})),i},vt=function(){function e(e,t,i,r,n,a){this._scheduledAd=e,this.player=t,this.options=i,this.item=i.item,this.params=i.params||{},this.wrapperOptions=r||{},"boolean"!=typeof this.wrapperOptions.followAdditionalAds&&(this.wrapperOptions.followAdditionalAds=!0),"boolean"!=typeof this.wrapperOptions.allowMultipleAds&&(this.wrapperOptions.allowMultipleAds=!0),this.debugTrackFn=n,B(this,t.Events),this._history=[],this.loadedAds=[],this.parser=null,this.promise=null,this.xmlhttp=null,this.wrappedTags=null,this.options.isPodItemLoader||(e.adPlayIds={}),this.extensionHandlers=B({},window.jwVastExtensionHandlers,this.params.extensions),this.mock=a||!1}var i=e.prototype;return i.load=function(e){var t=this;if(null===this.promise){this._history.push(e);var i=this.options.requestFilter;this.promise=new Promise((function(r,n){t.xmlhttp=t.player.utils.ajax({url:e,withCredentials:t.params.withCredentials,retryWithoutCredentials:!0,requireValidXML:!0,timeout:t._scheduledAd.requestTimeout,requestFilter:i},r,(function(e,t,i,r){return n(r)}))})).catch((function(i){if(null!==t.player)throw t.ajaxError(i,e)})).then((function(i){if(null!==t.player){var r=i.responseXML||i.responseText;return t.trigger(m,{tag:e,xml:r}),t.parseVast(r,e)}}))}return this.promise},i.destroy=function(){var e;(e=this.xmlhttp)&&(e.onload=null,e.onreadystatechange=null,e.onerror=null,e.abort&&e.abort()),this.off(),this.player=null,this.xmlhttp=null},i.scheduledAd=function(){return this._scheduledAd},i.allAds=function(){return this.loadedAds},i.podMultipleVastLoaders=function(e){var t=this,i=e.map((function(e){return e.then((function(e){var i=e.adPod();if(i.length)return i;var r=e.adBuffet();return r.length?[r[0]]:Promise.reject({vloader:t,message:"No compatible ad"})})).catch((function(e){return{error:e}}))}));return Promise.all(i).then((function(e){var i=0,r=e.reduce((function(e,r,n){if(r.error)return r.error.tagIndex=n,t.trigger(P,r.error),e;if(r.length&&0!==n){var a="p"+i+"w"+t._scheduledAd._waterfallIndex;t._scheduledAd.adPlayIds[a]=t._scheduledAd.adRequestIds[n]}return r.forEach((function(t){t.sequence=++i,e.push(t)})),e}),[]);return r.length?(t.loadedAds=r,t):null}))},i.adPod=function(){var e=[];return this.loadedAds.forEach((function(t){t.sequence&&e.push(t)})),e.sort((function(e,t){return e.sequence-t.sequence})),e},i.adBuffet=function(){var e=[];return this.loadedAds.forEach((function(t){t.sequence||e.push(t)})),e},i.parseVast=function(e,t){var i=this;return this.parseXMLString(e,t).then((function(e){return i.checkForWrappers(e,t)})).then((function(e){return i.checkExtensionHandlers(e)}))},i.parseXMLString=function(e,t){var i=this;return null===this.parser&&(this.parser=new Fe(null,this.player.utils)),new Promise((function(t){var r,n=(r=e,("object"==typeof Node?r instanceof Node:r&&"object"==typeof r&&"number"==typeof r.nodeType&&"string"==typeof r.nodeName)?e:i.player.utils.parseXML(e));if(null===n){throw{message:"Invalid XML",code:100}}return t(i.parser.parse(n,i.xmlhttp))})).catch((function(e){if(null!==i.player){var r=e.code||900,n=e.adErrorCode||1e4+r;throw i.sendErrorEvent(e.message,r,n,t)}}))},i.checkForWrappers=function(i,r){var n=this;if(null===this.player)return null;if(0===i.length)throw this.sendErrorEvent("No ads",303,10303,r);var a=i.filter((function(e){return!e.sequence})).map((function(e){return e._currentTag=r,e}));this.wrapperOptions.allowMultipleAds?this.loadedAds=i:this.loadedAds=a,this.options.wrapper=this.options.wrapper||[];var s=this.options,o=s.adsystem,l=s.dealId;o&&this.options.wrapper.push(o),l&&(this.options.wrapperDealId=l),this.options.adsystem=this.loadedAds[0].adsystem,this.options.dealId=this.loadedAds[0].dealId;var d=[];return i.forEach((function(i,r){if(i.wrappedURI){if(!1===n.wrapperOptions.followAdditionalWrappers)return;n.options.wrappedTags=n.options.wrappedTags||[n._scheduledAd._currentTag],n.options.wrappedTags.push(i.wrappedURI);var s=new e(n._scheduledAd,n.player,n.options,{fallbackOnNoAd:i.fallbackOnNoAd,allowMultipleAds:i.allowMultipleAds,followAdditionalWrappers:i.followAdditionalWrappers},n.debugTrackFn);s.on(m,(function(e){n.trigger(m,e)}),n);var o=xe(i.wrappedURI,n.player,n.item,t,n.params,i).then((function(e){return s.load(e)})).then((function(e){s.off(m,null,n);var t=mt(i,e.allAds()),r=n.loadedAds.indexOf(i);Array.prototype.splice.apply(n.loadedAds,[r,1].concat(t))})).catch((function(e){s.off(m,null,n);var t=n.sendAdpodErrorEvent(e,i,r),o=i.fallbackOnNoAd&&i.sequence&&a.length,l=n.loadedAds.indexOf(i);if(o)return i.loadError=t,void e.vloader.destroy();if(n.loadedAds.splice(l,1),e.vloader.destroy(),t.type!==P)throw t;n.trigger(P,t)}));d.push(o)}else n.options.wrapper.length&&(i.wrapper=n.options.wrapper,i.wrappedTags=n.options.wrappedTags,i.dealId=n.options.wrapperDealId)})),Promise.all(d)},i.checkExtensionHandlers=function(){var e=this;if(null===this.player)return null;var t=this.loadedAds.filter((function(e){return!e.sequence}));return this.loadedAds.extensionNodes&&(this.loadedAds=this.handleExtensionCallback(this.loadedAds)),this.loadedAds.forEach((function(i,r){if(i.loadError)if(t.length){var n=e.loadedAds[r+1],a=n&&!n.sequence?n:t[0];e.loadedAds[r]=B({},a,{sequence:i.sequence})}else e.trigger(P,i.loadError)})),this.validateAdResponses()},i.validateAdResponses=function(){var e=this.loadedAds.slice(0),t=e.length;e.forEach((function(t){t.media&&t.media.length||e.length--}));var i=0===t,r=e.length!==t;if((i||r)&&!this.mock)throw this.sendErrorEvent("Ad Tag Empty",101,10101,this._history[this._history.length-1]);return this},i.handleExtensionCallback=function(e){var t=this,i=function(i){if(e.extensionNodes&&e.extensionNodes[i]){var r=e.extensionNodes[i];e=r.reduce((function(e,r){try{e=t.extensionHandlers[i](e,r)}catch(e){console.debug("Error with handling extension callback function: ",e)}return e}),e)}};for(var r in this.extensionHandlers)i(r);return e},i.ajaxError=function(e,t){if(this.player.getAdBlock())return this.sendErrorEvent("Ad playback blocked by an ad blocker",900,60003,t);var i=e.code;if(601===i||602===i)return this.sendErrorEvent("Invalid XML",100,10100,t);var r=this.options.wrappedTags&&this.options.wrappedTags.length,n=r?301:900,a=r?10301:60006;return this.sendErrorEvent(e.message||"Error loading file",n,a,t)},i.firstUrl=function(){return this._history&&this._history.length?this._history[0]:""},i.sendAdpodErrorEvent=function(e,t,i){var r=e.message,n=e.code,a=e.adErrorCode,s=e.url;if(1===this.loadedAds.length)return this.sendErrorEvent(r,n,a,s,i);var o={message:r,code:n,adErrorCode:a,podIndex:i,vloader:this,tag:this.firstUrl()||s,type:P};return this.trackError(o,t),this.wrappedTags=s,o},i.sendErrorEvent=function(e,t,i,r,n){var a={message:e,code:t,adErrorCode:i,podIndex:n,vloader:this,tag:this.firstUrl()||r,adsystem:this.options.adsystem||""};return this.options.wrappedTags&&(a.wrapperAdSystem=this.options.wrapper||"",a.wrappedTags=this.options.wrappedTags),this.trackError(a),a},i.trackError=function(e,t){var i=e.vloader.allAds();if(i&&i.length){var r=t||i[0];if(r){var n=r.trackers;if(n&&n.error)new ft(r,n,this.debugTrackFn,this.player,this.options).error(e.code)}}},e}(),gt=function(){function e(e,t,i,r,n){var a=this;this.player=e,this.state=e.state,this.vpaidURL=i,this.adTag=r,this.adParams=n.adParams,this.vpaidControls=n.vpaidControls,this.remainingTimeInterval=null,this.type="vpaid",this.instream=t||e.createInstream(),this.vpaidState={linear:!1,expanded:!1,remainingTime:-1},this.paused=!1,B(this,e.Events),this.setMuteCallback=function(){a.handleMute?a.setMute():a.handleMute=!0},this.playerContainer=this.player.getContainer(),n.adOptOut?setTimeout((function(){a.sendEvent("error",{message:"Conditional ad rejected",code:408})}),0):this.iframe=function(e,t,i,r){var n=document.createElement("iframe");n.setAttribute("allow","autoplay"),n.src="javascript:false",n.classList.add("jw-vpaid-iframe"),n.scrolling="no",i.querySelector(".jw-media").appendChild(n);var a=n.contentWindow.document;return a.open().write("\n    <body onload=\"\n        var js = document.createElement('script');\n        js.src = '"+t+"';\n        js.addEventListener('load', function() { window.myCallback(); });\n        document.body.appendChild(js);\"\n    style=\"margin: 0\">"),n.contentWindow.myCallback=r,a.close(),n}(e.utils,this.vpaidURL,this.playerContainer,this.callback.bind(this))}var t=e.prototype;return t.sendEvent=function(e,t){(t=t||{}).tag||(t.tag=this.adTag),this.trigger(e,t)},t.sendTimeEvent=function(e,t,i){var r=t.getAdDuration(),n=t.getAdRemainingTime(),a=B({duration:r},i);this.sendEvent(e,a),n>0&&(a.position=r-n,this.trigger("time",a))},t.handleQuartile=function(e,t){this.sendTimeEvent("quartile",e,{quartile:t})},t.genEvent=function(e){var t=this;return function(i){t.on(e,i)}},t.setMute=function(){var e=0===this.vpaidAd.getAdVolume();this.player.getMute()!==e&&this.player.setMute(e)},t.prepareNonlinearAd=function(){if(this.player.utils.style(this.iframe,{height:150}),this.iframe.classList.add("jw-vpaid-non-linear"),this.resize(null,150),this.instream){this.instream.noResume=!0,this.instream.applyProviderListeners(null),this.instream.destroy(),this.instream=null;var e=this.playerContainer.querySelector(".jw-media"),t=e.querySelector("video,audio");e.insertBefore(t,this.iframe),t.play()}},t.progressInterval=function(e){var t=this;if(clearInterval(this.remainingTimeInterval),e&&e.getAdRemainingTime){var i=-1;this.remainingTimeInterval=setInterval((function(){if(!t.paused){var r=e.getAdRemainingTime();isNaN(r)||r<=0||i===r||(i=r,t.sendTimeEvent("remainingTimeChange",e,{remainingTime:r}))}}),250)}},t.genListeners=function(e){var t=this;return{AdLoaded:function(){e.setAdVolume(t.getPlayerVolume()),e.startAd()},AdStarted:function(){var i=e.getAdDuration?e.getAdDuration():0,r=!e.getAdLinear||e.getAdLinear(),a=r?"linear":"nonlinear";if(r){t.instream=t.instream||t.player.createInstream(),t.vpaidControls||t.instream.hide();var s=t.instream.getMediaElement();t.player.getPip()&&t.player.requestPip(s),t.progressInterval(e)}else t.prepareNonlinearAd();t.sendEvent("impression",{linear:a,duration:i}),t.sendEvent("play",{oldstate:"buffering",newstate:n,linear:a}),t.handleMute=!0,e.subscribe(t.setMuteCallback,"AdVolumeChange",e)},AdVideoStart:function(){t.sendEvent("started")},AdStopped:function(){t.sendEvent("stopped")},AdPaused:function(){t.paused||(t.paused=!0,t.sendEvent("pause",{newstate:r,oldstate:n}))},AdPlaying:function(){if(t.paused){var i=!e.getAdLinear||e.getAdLinear()?"linear":"nonlinear";t.paused=!1,t.sendEvent("play",{newstate:n,oldstate:r,linear:i})}},AdLinearChange:function(){!e.getAdLinear||e.getAdLinear()?(t.player.utils.style(t.iframe,{height:"100%"}),t.player.off(null,null,t),t.instream=t.instream||t.player.createInstream(),t.instream.init(),t.vpaidControls||t.instream.hide()):t.prepareNonlinearAd()},AdDurationChange:function(){t.sendTimeEvent("remainingTimeChange",e,{isDurationChange:!0,remainingTime:e.getAdRemainingTime()})},AdRemainingTimeChange:function(){t.paused||t.sendTimeEvent("remainingTimeChange",e,{remainingTime:e.getAdRemainingTime()})},AdExpandedChange:function(){t.sendEvent("expandedChange",{expanded:e.getAdExpanded()})},AdSkippableStateChange:function(){t.sendEvent("skippableStateChange",{skippable:e.getAdSkippableState()})},AdSkipped:function(){t.sendEvent("skipped")},AdVideoFirstQuartile:function(){t.handleQuartile(e,1)},AdVideoMidpoint:function(){t.handleQuartile(e,2)},AdVideoThirdQuartile:function(){t.handleQuartile(e,3)},AdVideoComplete:function(){t.sendEvent("complete")},AdUserClose:function(){t.sendEvent("close")},AdClickThru:function(e,i,r){t.sendEvent("click",{id:i,url:e,playerHandles:r})},AdError:function(e){var i=function(e){if(e){var t=e.match(/\b(?:[34])[0-9]{2}\b/);if(t)return parseInt(t[0],10);if(e.match(/timeout/i))return e.match(/vpaid|vast/i)?301:402;if(e.match(/found/i))return 401;if(e.match(/supported/i))return 403;if(e.match(/(?:displaying|media file)/i))return 405}return 901}(e);t.sendEvent("error",{message:e,code:i,adErrorCode:5e4+i})}}},t.callback=function(){try{this.vpaidAd=this.iframe.contentWindow.getVPAIDAd();var e=this.vpaidAd.handshakeVersion("2.0");if(parseFloat(e)<1)throw new Error("Invalid vpaid version in handshake")}catch(e){return void this.sendEvent("error",{message:e.message||"VPAID general error",code:901,adErrorCode:51901})}var t=this.vpaidAd,i=this.genListeners(t);Object.keys(i).forEach((function(e){t.subscribe(i[e],e,t)})),this.listeners=i;var r={AdParameters:this.adParams},n=this.iframe.contentWindow.document.createElement("div");n.className="jw-vpaid-wrapper",n.style.height="100%",this.iframe.contentWindow.document.body.appendChild(n),this.vpaidURL.indexOf("//imasdk.googleapis.com/js/sdkloader/vpaid_adapter.js")>=0&&(this.iframe.contentWindow.HTMLVideoElement=HTMLVideoElement);var a={videoSlot:this.instream.getMediaElement(),slot:n};t.initAd(this.player.getWidth(),this.player.getHeight(),"normal",1e3,r,a),t.setAdVolume(this.getPlayerVolume())},t.play=function(){this.vpaidAd.resumeAd()},t.pause=function(){this.vpaidAd.pauseAd()},t.skip=function(){return!(!this.vpaidAd.skipAd||!this.vpaidAd.getAdSkippableState())&&(this.vpaidAd.skipAd(),!0)},t.stop=function(){if(this.vpaidAd)try{this.vpaidAd.stopAd()}catch(e){}},t.getPlayerVolume=function(){return this.player.getMute()?0:this.player.getVolume()/100},t.setVolume=function(e){this.handleMute=!1,this.vpaidAd.setAdVolume(e/100)},t.resize=function(e,t){if(this.vpaidAd&&this.vpaidAd.resizeAd){var i=this.player.getFullscreen()||document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen?"fullscreen":"normal";this.vpaidAd.resizeAd(e||this.player.getWidth(),t||this.player.getHeight(),i)}},t.destroy=function(){var e=this;if(this.removeEvents(),clearInterval(this.remainingTimeInterval),this.vpaidAd)try{var t=this.listeners,i=this.vpaidAd;Object.keys(t).forEach((function(e){i.unsubscribe(t[e],e,i)})),i.unsubscribe(this.setMuteCallback,"AdVolumeChange",i)}catch(e){}setTimeout((function(){e.iframe&&e.iframe.parentNode&&e.iframe.parentNode.removeChild(e.iframe)}),0),this.vpaidAd=null,this.player=null,this.instream=null},t.removeEvents=function(){this.player&&this.player.off(null,null,this),this.off()},t.attachMedia=function(){},t.detachMedia=function(){},t.volume=function(){},t.mute=function(){},t.getState=function(){return this.vpaidState.linear?this.paused?r:n:"idle"},e}(),yt=function(){function e(e,t,i){this.player=e,this.icon=t,this.div=i;var r=this.utils=e.utils;this.images=[],this.iconContainer=function(e,t){var i=document.createElement("div");return i.className="jw-ad-icon-container",t.style(i,e),i}(t.style,r);var n=function(e,t){var i,r=e.resourceSource,n=e.resourceType;switch(n){case"iframe":(i=document.createElement("iframe")).src=r,i.scrolling="no";break;case"html":i=document.createElement("div"),t.replaceInnerHtml(i,r);break;default:(i=document.createElement("img")).src=r,i.setAttribute("type",n)}return t.addClass(i,"jw-ad-icon"),i}(t.resource,r);this.iconContainer.appendChild(n),i.appendChild(this.iconContainer);var a=1e3*r.seconds(t.offset);a>0?this.showTimeout=setTimeout(this.show.bind(this),a):this.show(),this.ui=new r.UI(this.iconContainer).on("click",this.clickHandler,this)}var t=e.prototype;return t.clickHandler=function(){this.player.pause({reason:E}),this.sendPing(this.icon.trackers.iconClick),this.utils.openLink(this.icon.clickThrough,"_blank",{rel:"noreferrer"})},t.show=function(){clearTimeout(this.showTimeout),this.utils.addClass(this.iconContainer,"jw-ad-icon-active"),this.sendPing(this.icon.trackers.iconView),this.icon.duration&&(this.duration=this.utils.seconds(this.icon.duration),this.beginningPosition=this.utils.seconds(this.icon.offset))},t.updateTime=function(e){e-this.beginningPosition>=this.duration&&this.remove()},t.sendPing=function(e){if(e){var t=this.images,i=new Image;i.src=e;for(var r=t.length;r--&&(t[r].width||t[r].complete);)t.length=r;t.push(i)}},t.remove=function(){clearTimeout(this.showTimeout),this.div.contains(this.iconContainer)&&this.div.removeChild(this.iconContainer),this.ui&&(this.ui.destroy(),this.ui=null)},e}(),kt=function(e,t,i,r,n){e.tracker=new ft(e,e.trackers,t,i,r,n)},At=function(e){return function(e){return"application/javascript"===e.type||"application/x-javascript"===e.type}(e)?"html5":"flash"},Pt=function(e){for(var t,i=0;i<e.media.length;i++){var r=e.media[i];if("html5"===At(r)){t=r;break}}return t},wt=function(e){e&&e.iconInstances&&(e.iconInstances.forEach((function(e){e.remove()})),e.iconInstances=null)},bt=function(){function e(e,t,i){this.player=t,this.playlistItemManager=i;var r=i.adPlayerProperties,n=r.staticPlayer,a=r.companion,s=r.div,o=r.optionalParams;this.staticPlayer=n,this.companion=a,this.div=s,this.optionalParams=o,this.omidSupport=o.omidSupport,this.debugTrackFn=o.debugTrackFn,this.scheduledAd=e.scheduledAd(),this.vastBuffet=e.adBuffet(),this.vastAdPod=e.adPod(),this.vastAd=this.vastBuffet.length?this.vastBuffet[0]:null,this.adType=null,this.vpaidPlayer=null,this.instreamPlayer=null,this.blockingInstreamPlayer=null,this.mediaType=null,this.adPodItems=null,this.creativeTimeout=null,this.vastOptions=null,this.duration=0,this.position=0,this.initialIndex=0,this.viewablePlayedTime=0,this.adViewableImpressionHandler=t.utils.noop,this.lastPosition=null,this.reason=null,B(this,t.Events)}var t=e.prototype;return t.init=function(e,t){return this.init=function(){throw new Error("Adplayer can only be initialized once")},this.blockingInstreamPlayer=e,this.reason=t,this.prepareAdPod()?(this.player.on(a,this.playerFullscreenHandler,this),this.player.on(s,this.playerVolumeHandler,this),this.player.on(o,this.muteHandler,this),this.player.on(d,this.playerResizeHandler,this),this.playAd()):Promise.reject()},t.prepareAdPod=function(){var e,t=this,i=null,r=0,n=[];if(this.vastAd&&(kt(this.vastAd,this.debugTrackFn,this.player,this.optionalParams,this.blockingInstreamPlayer),(i=this.prepareAdPodItem(this.vastAd))&&"vpaid"===i.adType&&!Pt(this.vastAd)&&(i=null)),this.vastAdPod)for(var a=null,s=0;s<this.vastAdPod.length;s++){var o=this.vastAdPod[s];kt(o,this.debugTrackFn,this.player,this.optionalParams,this.blockingInstreamPlayer);var l=this.prepareAdPodItem(o);if(l){if(a!==l.adType&&"instream"===a)break;if(a=l.adType,"vpaid"!==l.adType||Pt(o)){var d=n.length+r===s;l&&d&&n.push(l)}else r++}else r++}return n.length||i?(n.length?(e=n,this.vastOptions=[],e.forEach((function(e){t.vastOptions.push(t.getInstreamOptions(e.vastAd))}))):(e=i,this.vastOptions=this.getInstreamOptions(this.vastAd)),this.adPodItems=e,!0):(this.scheduledAd._pod&&this.scheduledAd._pod.length||this.adError("No Compatible Creatives",403),!1)},t.prepareAdPodItem=function(e){e.tracker.linear="linear";var t=(""+e.media[0].adType).toLowerCase()||"instream";"vpaid"!==t||Pt(e)||(t="instream");var i={vastAd:e,sources:[],adType:t};void 0!==this.scheduledAd.skipoffset&&(i.skipoffset=this.scheduledAd.skipoffset);var r,n,a,s,o=e.media,l={};if(o.forEach((function(e,t){i.sources.push({file:e.file,mimeType:e.type,type:(""+e.type).replace(/^(?:video|audio)\/(?:x-)?/,""),id:t}),l[e.file]={width:e.width||0,height:e.height||0,bitrate:e.bitrate||e.maxBitrate,id:t}})),"instream"===t&&(i.sources=(r=i.sources,n=jwplayer.api.availableProviders.filter((function(e){return"flash"!==e.name})),a=r.filter((function(e){return n.some((function(t){return t.supports(e)}))})),(s=a.filter((function(e){return"3gpp"!==e.type}))).length?s:a)),0===i.sources.length)return null;var d=this.player.getSafeRegion(!1).width,h=this.player.getConfig().bandwidthEstimate||5e5,u=function(){var e=h/1e3*.95,t=i.sources.map((function(e){return l[e.file]})),r=t.filter((function(e){return e.width>=d})).sort((function(e,t){return e.width-t.width}));r.length||(r=t.sort((function(e,t){return t.width-e.width})));var n=r.filter((function(e){return e.width===r[0].width}));if(n.length>1){var a=n.reduce((function(t,i){return i.bitrate<e&&i.bitrate>t.bitrate?i:t})),s=n.reduce((function(t,i){return i.bitrate>=e&&i.bitrate<t.bitrate?i:t}));return a||s}return n[0]}().id;return i.vastAd.selectedMedia=i.sources.filter((function(e){return e.id===u}))[0],this.mediaType=i.vastAd.selectedMedia.mimeType.toLowerCase(),i.sources=[i.vastAd.selectedMedia],i},t.getInstreamOptions=function(e){return{skipoffset:this.getSkipOffset(e),skipMessage:this.optionalParams.skipMessage,skipText:this.optionalParams.skipText}},t.getSkipOffset=function(e){var t=[this.scheduledAd.skipoffset,this.optionalParams.skipoffset,e.skipoffset].filter((function(e){return null!=e}));return e.skipoffset=t.length?this.player.utils.seconds(t[0]):void 0,e.skipoffset},t.getVastAd=function(){var e,t=this.scheduledAd._adPodIndex;if(this.adPodItems){if((e=this.adPodItems.length?this.adPodItems[t]:this.adPodItems).vastAd)return e.vastAd}else if(this.vastAdPod&&this.vastAdPod.length)return this.vastAdPod[t];return this.vastAd},t.adError=function(e,t,i){clearTimeout(this.viewableTimeout),this.viewableTimeout=null,clearTimeout(this.creativeTimeout),this.creativeTimeout=null;var r=this.getVastAd();wt(r),t=t||900;var n="vpaid"===this.adType?5e4:1e4;i=i||n+t;var a=B({},this.scheduledAd,r),s={jwpseg:a.jwpseg},o=Y(this.playlistItemManager,{message:e,code:t,adErrorCode:i},a,s);this.vastAdPod&&this.scheduledAd._adPodIndex<this.vastAdPod.length-1?this.triggerEvent(P,o):(r.tracker.error(o.code),this.triggerEvent(c,o),this.removePlayerListeners())},t.playAd=function(){var e=this.scheduledAd._adPodIndex,t=this.adPodItems[e]||this.adPodItems;if(this.adType=t.adType,this.blockingInstreamPlayer){var i=this.optionalParams.loadingAd;this.blockingInstreamPlayer.setText(i)}if("vpaid"===this.adType)return this.playVpaid(t.vastAd);if("static"===this.adType)return this.playStatic(),Promise.resolve();var r=Array.isArray(this.adPodItems)?this.adPodItems.slice(e):this.adPodItems,n=Array.isArray(this.vastOptions)?this.vastOptions.slice(e):this.vastOptions;return this.initialIndex=e,this.playInstream(r,n).catch(this.player.utils.noop)},t.clearVpaidBlocking=function(){var e=this.vpaidPlayer.instream;e&&e!==this.blockingInstreamPlayer&&(this.vpaidPlayer.instream=null,this.clearBlocking(e))},t.clearBlocking=function(e){(e=e||this.blockingInstreamPlayer)&&e!==this.instreamPlayer&&e.destroy()},t.getState=function(){return this.instreamPlayer?this.instreamPlayer.getState():this.vpaidPlayer?this.vpaidPlayer.getState():""},t.clearNonlinear=function(){this.staticPlayer.stop(),this.vpaidPlayer&&(this.clearVpaidBlocking(),this.vpaidPlayer&&(this.vpaidPlayer.stop(),this.vpaidPlayer.destroy(),this.vpaidPlayer=null))},t.destroy=function(){if(this.off(),this.removePlayerListeners(),clearTimeout(this.viewableTimeout),this.viewableTimeout=null,clearTimeout(this.creativeTimeout),this.creativeTimeout=null,this.instreamPlayer){var e=this.instreamPlayer;this.instreamPlayer=null,this.clearBlocking(e)}this.vpaidPlayer&&(this.clearVpaidBlocking(),this.vpaidPlayer&&(this.vpaidPlayer.destroy(),this.vpaidPlayer=null)),this.clearNonlinear(),wt(this.vastAd),this.player=null,this.instreamPlayer=null,this.scheduledAd=null,this.vastBuffet=null,this.vastAd=null,this.vastAdPod=null},t.pause=function(e){var t=e.reason;this.reason=t||T,this.instreamPlayer?this.instreamPlayer.pause():this.vpaidPlayer&&this.vpaidPlayer.pause()},t.play=function(e){var t=e.reason;this.reason=t||T,this.instreamPlayer?this.instreamPlayer.play():this.vpaidPlayer&&this.vpaidPlayer.play()},t.skip=function(){if(this.instreamPlayer){var e=this.getSkipOffset(this.getVastAd());if(e>0&&this.position<e)return;this.instreamPlayer.skipAd()}else this.vpaidPlayer&&this.vpaidPlayer.skip()},t.removePlayerListeners=function(){this.player&&(this.player.off(a,this.playerFullscreenHandler,this),this.player.off(s,this.playerVolumeHandler,this),this.player.off(o,this.muteHandler,this),this.player.off(l,this.viewableHandler,this),this.player.off(d,this.playerResizeHandler,this)),this.instreamPlayer&&this.instreamPlayer.off(null,null,this),this.vpaidPlayer&&(this.vpaidPlayer.removeEvents(),this.clearVpaidBlocking(),this.vpaidPlayer&&(this.vpaidPlayer.destroy(),this.vpaidPlayer=null)),this.staticPlayer.stop(),this.staticPlayer.removeEvents()},t.adEventObject=function(e){var t=this.getVastAd(),i=B({},this.scheduledAd,t),r=$(this.playlistItemManager,i);return r.viewable=this.player.getViewable(),this.adPodItems&&this.adPodItems.length&&(r.sequence=this.scheduledAd._adPodIndex+1,r.podcount=this.adPodItems.length),this.mediaType&&(r.creativetype=this.mediaType),this.scheduledAd._vmap&&(r.vmap=this.scheduledAd._vmap),-1!==j.indexOf(e)&&(r.universalAdId=t.universalAdId,r.categories=t.categories),r},t.playStatic=function(){this.vastAd.tracker.linear="nonlinear";var e=this.vastAd.media[0];this.vastAd.selectedMedia=e;var t=this.vastAd.clickthrough||"",i=this.staticPlayer;i.removeEvents(),i.on("play",this.impressionHandler,this),i.on("play",this.playHandler,this),i.on("complete",this.combinedCompleteHandler,this),i.on("click",this.clickStaticHandler,this),i.on("error",this.staticErrorHandler,this),i.playAd(e.file,t,e.minDuration,this.scheduledAd._currentTag,this.scheduledAd.requestTimeout),this.clearBlocking()},t.creativeAdError=function(e,t,i){if(this.adError(e,t,i),this.adPodItems&&this.adPodItems.length-1>this.scheduledAd._adPodIndex){if(this.vpaidPlayer&&(this.vpaidPlayer.destroy(),this.vpaidPlayer=null),"instream"===this.adType&&this.instreamPlayer)return void this.instreamPlayer.loadNextItemOnError();this.scheduledAd._adPodIndex++,this.playAd()}},t.playVpaid=function(e){var t=this;clearTimeout(this.creativeTimeout),this.creativeTimeout=setTimeout((function(){t.creativeAdError("VPAID tag communication timeout",900,50004)}),this.scheduledAd.creativeTimeout),this.vastAd=e;var i=Pt(e),r=this.optionalParams.conditionaladoptout&&e.conditionalAd;if(this.vastAd.selectedMedia=i,this.mediaType=i.type,"flash"===At(i))return this.creativeAdError("Flash creatives are not supported",403,10403),Promise.reject();var n={adParams:this.vastAd.adParams,vpaidControls:this.optionalParams.vpaidcontrols,adOptOut:r};return this.vpaidPlayer=new gt(this.player,this.blockingInstreamPlayer,i.file,this.scheduledAd._currentTag,n),this.blockingInstreamPlayer&&this.blockingInstreamPlayer.applyProviderListeners(this.vpaidPlayer),this.vpaidPlayer.on("play",this.playHandler,this),this.vpaidPlayer.on("pause",this.pauseHandler,this),this.vpaidPlayer.on("quartile",this.quartileHandler,this),this.vpaidPlayer.on("remainingTimeChange",this.remainingTimeHandler,this),this.vpaidPlayer.on("click",this.clickVpaidHandler,this),this.vpaidPlayer.on("error",this.playbackErrorHandler,this),this.vpaidPlayer.on("impression",this.impressionHandler,this),this.vpaidPlayer.on("expandedChange",this.vpaidExpandedHandler,this),this.vpaidPlayer.on("close",this.adCloseHandler,this),this.vpaidPlayer.on("skipped",this.vpaidAdSkipped,this),this.vpaidPlayer.on("stopped",this.endOfVpaidAdHandler,this),this.vpaidPlayer.on("complete",this.adCompleteHandler,this),this.vpaidPlayer.on("started",this.adStartedHandler,this),this.vpaidPlayer.on("skippableStateChange",this.skippableStateChangeHandler,this),Promise.resolve()},t.skippableStateChangeHandler=function(e){e.skippable&&this.blockingInstreamPlayer&&(this.blockingInstreamPlayer.off(w,this.skipVpaidAd,this),this.blockingInstreamPlayer.setupSkipButton(0,this.optionalParams,this.player.utils.noop),this.blockingInstreamPlayer.on(w,this.skipVpaidAd,this))},t.playInstream=function(e,t){var i=this,r=this.player.getEnvironment().OS;if(r.android&&2===r.version.major&&3===r.version.minor)return this.adError("Android 2.3 not supported",900,60007),Promise.reject();clearTimeout(this.creativeTimeout),this.blockingInstreamPlayer?this.instreamPlayer=this.blockingInstreamPlayer:this.instreamPlayer=this.player.createInstream().init(),this.instreamPlayer.on("play",this.playHandler,this),this.instreamPlayer.on("pause",this.pauseHandler,this),this.instreamPlayer.on("state",this.stateHandler,this),this.instreamPlayer.on("time",this.timeHandler,this),this.instreamPlayer.on("playlistItem",this.playlistItemHandler,this),this.instreamPlayer.on("complete",this.adCompleteHandler,this),this.instreamPlayer.on("playlistComplete",this.endOfAdBreakHandler,this),this.instreamPlayer.on("mute",this.muteHandler,this),this.instreamPlayer.on("instreamClick",this.clickInstreamHandler,this),this.instreamPlayer.on("adSkipped",this.adSkipped,this),this.instreamPlayer.on("error",this.playbackErrorHandler,this),this.instreamPlayer.on("mediaError",this.playbackErrorHandler,this),this.instreamPlayer.on("destroyed",(function(){i.instreamPlayer=null}),this);var n=this.instreamPlayer.loadItem(e,t);return this.clearBlocking(),n},t.playerFullscreenHandler=function(e){var t=this.getVastAd().tracker;t.trackOmidEvent(a,e.fullscreen),e.fullscreen&&t.started&&t.fullscreen()},t.playerResizeHandler=function(e){this.getVastAd().tracker.trackOmidEvent("resize",e.width,e.height),this.vpaidPlayer&&this.vpaidPlayer.resize(e.width,e.height)},t.playerVolumeHandler=function(e){this.getVastAd().tracker.trackOmidEvent("volume",e.volume/100),this.vpaidPlayer&&this.vpaidPlayer.setVolume(e.volume)},t.playlistItemHandler=function(e){var t=this;this.instreamPlayer&&(clearTimeout(this.creativeTimeout),this.creativeTimeout=setTimeout((function(){t.creativeAdError("Video creative timeout",402,10402)}),this.scheduledAd.creativeTimeout),this.scheduledAd._adPodIndex=e.index+this.initialIndex,this.scheduledAd._adPodIndex>0&&this.triggerEvent(f))},t.impressionHandler=function(e){var t=this.getVastAd(),i=t.tracker,r=B({},this.scheduledAd,t),n=e.duration||t.duration||this.getDurationFromVideoTag(),a=this.player.getVolume()/100;i.impression(n,a),this.player.getViewable()?i.viewable():i.notViewable(),this.triggerEvent(p,$(this.playlistItemManager,r,{duration:n,linear:e.linear||i.linear})),this.setupViewableListener()},t.viewableHandler=function(e){e.viewable?(this.viewablePlayedTime=0,this.lastPosition=null,this.adViewableImpressionHandler=this.adViewableHandler):this.adViewableImpressionHandler=this.player.utils.noop},t.bufferStartHandler=function(e){e.buffering=!0,e.trackOmidEvent("bufferStart")},t.bufferFinishHandler=function(e){e.buffering=!1,e.trackOmidEvent("bufferFinish")},t.stateHandler=function(e){var t=e.oldstate,i=e.newstate;if(i!==t||"playing"===i){var r="loading"===i||"stalled"===i,n=this.getVastAd().tracker;!r&&n.buffering?this.bufferFinishHandler(n):r&&n.started&&this.bufferStartHandler(n)}},t.playHandler=function(e){var t=this;clearTimeout(this.creativeTimeout),this.creativeTimeout=null;var i,n=this.getVastAd(),a=n.tracker;if(a.started)e.oldstate===r&&(a.resume(),this.dispatchPlay(e));else{this.vpaidPlayer&&(a.linear=e.linear),this.instreamPlayer&&this.impressionHandler({linear:a.linear});var s=B({},this.scheduledAd,n),o=$(this.playlistItemManager,s,{linear:a.linear,metadata:!0});if(this.triggerEvent(g,o),n.companions){var l=$(this.playlistItemManager,s,{companions:(i=n.companions,i.map((function(e){var t,i="iframe"===e.type||"html"===e.type?e.type:"static";return e.trackers&&e.trackers.creativeView&&e.trackers.creativeView.length&&(t=e.trackers.creativeView),{width:e.width,height:e.height,type:i,resource:e.source,creativeview:t,click:e.clickthrough}})))});this.triggerEvent("adCompanions",l)}n.icons&&(n.iconInstances=n.icons.map((function(e){return new yt(t.player,e,t.div)})));var d,h=this.companion;d=this.player.utils.flashVersion()>9?n.companions:function(e){return e?e.filter((function(e){return e.type.indexOf("flash")<0})):[]}(n.companions),this.optionalParams.companion&&d&&d.length&&(a.hasComp=h.addCompanion(this.optionalParams.companion,d)),a.start(),a.creativeView(),this.dispatchPlay(e)}},t.pauseHandler=function(e){clearTimeout(this.creativeTimeout),this.creativeTimeout=null,this.getVastAd().tracker.pause(),null===this.reason&&"vpaid"===this.adType&&(this.reason=_),this.setState(e)},t.remainingTimeHandler=function(e){var t=this;e.duration?this.duration=e.duration:this.duration=Math.max(1,this.duration,e.remainingTime);var i=e.remainingTime>=0?this.duration-e.remainingTime:0;this.position===i?this.creativeTimeout=this.creativeTimeout||setTimeout((function(){t.creativeAdError("Video stall",400)}),this.scheduledAd.creativeTimeout):this.creativeTimeout&&(clearTimeout(this.creativeTimeout),this.creativeTimeout=null),this.timeHandler({position:i,duration:this.duration,isDurationChange:e.isDurationChange})},t.quartileHandler=function(e){if(e.duration)this.duration=e.duration;else{var t=4*e.remainingTime/(4-e.quartile);this.duration=Math.max(this.duration,1,t)}this.timeHandler({position:this.duration*e.quartile*.25,duration:this.duration})},t.adViewableHandler=function(e){var t=e.position;null===this.lastPosition&&(this.lastPosition=t);var i=t-this.lastPosition;this.lastPosition=t,i=Math.min(Math.max(0,i),4),this.viewablePlayedTime+=i,this.viewablePlayedTime>=2&&(this.player.off(l,this.viewableHandler,this),this.adViewableImpressionHandler=this.player.utils.noop,this.triggerEvent("adViewableImpression",{}))},t.timeHandler=function(e){var t=this.getVastAd(),i=e.position,r=e.duration;this.adViewableImpressionHandler(e);var n=r-i,a=t.tracker,s=this.optionalParams.dynamicMessage||"",o=this.optionalParams.podMessage||"";if(s&&n>0){if(s=s.replace(/(\b)xx(s?\b)/gi,"$1"+Math.ceil(n)+"$2"),this.adPodItems&&this.adPodItems.length>1&&o){var l=this.scheduledAd._adPodIndex+1;s=(o=(o=o.replace(/__AD_POD_CURRENT__/g,""+l)).replace(/__AD_POD_LENGTH__/g,""+this.adPodItems.length))+" "+s}this.instreamPlayer?this.instreamPlayer.setText(s):this.vpaidPlayer&&this.vpaidPlayer.instream&&this.vpaidPlayer.instream.setText(s)}if(!e.isDurationChange){a&&a.time(i,r),t.iconInstances&&t.iconInstances.forEach((function(e){e.updateTime(i)}));var d={};d.position=this.position=i,d.duration=r,this.triggerEvent("adTime",d)}},t.combinedCompleteHandler=function(){this.adCompleteHandler(),this.endOfAdBreakHandler()},t.adCompleteHandler=function(){clearTimeout(this.viewableTimeout);var e=this.getVastAd();wt(e);var t=e.tracker;t.firedError||(t.complete(),this.triggerEvent(u))},t.adCloseHandler=function(){clearTimeout(this.viewableTimeout);var e=this.getVastAd().tracker;e.firedError||e.close()},t.adStartedHandler=function(){this.triggerEvent(b)},t.endOfVpaidAdHandler=function(){if(clearTimeout(this.viewableTimeout),this.adPodItems&&this.adPodItems.length-1>this.scheduledAd._adPodIndex)return this.vpaidPlayer&&(this.vpaidPlayer.destroy(),this.vpaidPlayer=null),this.scheduledAd._adPodIndex++,void this.playAd();this.endOfAdBreakHandler()},t.endOfAdBreakHandler=function(){this.removePlayerListeners(),this.trigger(A)},t.muteHandler=function(e){var t=this.getVastAd().tracker;t&&(e.mute?t.mute():t.unmute(),this.vpaidPlayer&&this.vpaidPlayer.setVolume(e.mute?0:this.player.getVolume()))},t.clickStaticHandler=function(){var e=this.getVastAd();this.player.pause({reason:E}),this.clickThrough(e)},t.clickVpaidHandler=function(e){var t=this.getVastAd(),i=!0;e&&void 0!==e.url&&(!1===e.playerHandles&&(i=!1),t.clickthrough=e.url),this.clickThrough(t,i)},t.clickInstreamHandler=function(){this.instreamPlayer.getState()!==r&&this.clickThrough(this.getVastAd())},t.playbackErrorHandler=function(e){var t=e.message||"Error Playing Ad Tag",i=e.code;i&&232404===i?i=403:(!i||i<=4||i>901)&&(i=405),this.vpaidPlayer&&"function"==typeof this.vpaidPlayer.off?(this.vpaidPlayer.off(),this.creativeAdError(t,i,e.adErrorCode)):this.adError(t,i,e.adErrorCode)},t.staticErrorHandler=function(){this.adError("Unable to fetch NonLinear resource",502)},t.vpaidExpandedHandler=function(e){var t=this.getVastAd().tracker;e.expanded?t.expand():t.collapse()},t.getDurationFromVideoTag=function(){var e=this.blockingInstreamPlayer?this.blockingInstreamPlayer.getMediaElement():null;return e?e.duration:0},t.setupViewableListener=function(){this.player.off(l,this.viewableHandler,this),this.player.on(l,this.viewableHandler,this),this.viewableHandler({viewable:this.player.getViewable()})},t.dispatchPlay=function(e){"static"===this.adType||"vpaid"===this.adType&&"linear"!==e.linear||(null===this.reason&&"vpaid"===this.adType&&(this.reason=_),this.setState(e))},t.setState=function(e){var t=e.newstate,i=e.oldstate,r=t===n,a=this.adEventObject(r?k:y);(a.newstate=t,null!==this.reason)&&(a[r?"playReason":"pauseReason"]=this.reason,this.reason=null);this.vpaidPlayer?(a.oldstate=i,this.vpaidPlayer.trigger("state",a)):this.instreamPlayer.setEventData(a)},t.clickThrough=function(e,t){void 0===t&&(t=!0),e.tracker.click();var i={};e.clickthrough&&(i.clickThroughUrl=e.clickthrough),this.reason=E,this.triggerEvent(h,i),window.jwcast&&window.jwcast.player.id||e.clickthrough&&t&&window.open(e.clickthrough)},t.skipVpaidAd=function(){this.vpaidPlayer&&this.vpaidPlayer.skip()&&this.vpaidAdSkipped()},t.vpaidAdSkipped=function(){this.adSkipped(),this.endOfVpaidAdHandler()},t.adSkipped=function(){clearTimeout(this.viewableTimeout);var e=this.getVastAd();e.tracker.skip(),wt(e);var t="vpaid"===this.adType?void 0:this.getSkipOffset(e);this.triggerEvent(w,{duration:e.duration,skipoffset:t,position:this.position,watchedPastSkipPoint:this.position-t})},t.triggerEvent=function(e,t){var i=this.adEventObject(e);t&&B(i,t),this.trigger(e,i),-1===R.indexOf(e)&&this.player.trigger(e,i)},e}(),Et=function(){},Tt=function(e){return e.tag&&(void 0===e.podcount||1===e.sequence)},_t=function(e){var i,r;function n(i,r,n,a,s,o,l){var d;return(d=e.call(this,i,r,n,a,l)||this).client=t,d.config=a,d.item=n,d.params=s,d.player=i,d.adPlayerProperties=o,d._vloaderQueue=[],d._events=[],d.adPlayerQueue=[],d.qoe=new i.utils.Timer,d.reason=null,d._debugTrackFn=a.debug&&a.trackFn?a.trackFn:null,B(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(d),i.Events),d}r=e,(i=n).prototype=Object.create(r.prototype),i.prototype.constructor=i,Z(i,r);var a=n.prototype;return a.init=function(t,i){var r=this,n=e.prototype.init.call(this,t,i);return this.vmapPromise&&this.vmapPromise.then((function(e){!r.isDestroyed()&&e&&e.length&&e.forEach((function(e){var t=Y(r,e,null,i);r.dispatchAdError(t)}))})).catch((function(e){if(!r.isDestroyed()){var t=Y(r,e,null,i);r.enqueueAdEvent(c,t,i)}})),n},a.adPlayerImpressionHandler=function(e){Tt(e)&&(this.qoe.tick("adImpression"+e.id),e.timeLoading=this.qoe.between("adBreakStart","adImpression"+e.id)),this.player.trigger(p,e)},a.playAdAPI=function(e){var t=this;this.startBlocking(),Promise.resolve(e).then((function(){if(!t.isDestroyed())return t.triggerAdBreakEvents(e),t.startAdBreak(e,{adBlock:t.adBlockErrorDetected,reason:T})})).catch((function(e){return t.isDestroyed()?null:t.dispatchFatalAdError(e)}))},a.tryPlayAd=function(e,t){var i=this;return this.reason=t.reason||this.reason,this.dequeueAdEvents(),e?("nonlinear"===e.scheduledAd()._type&&this.stopBlocking(),this.playAd(e).catch((function(r){return i.isDestroyed()?null:i.adWaterfall(e,r,t)}))):(this.stopBlocking(),null)},a.playAd=function(e){var t=this,i=e.scheduledAd();return 0===i._waterfallIndex&&this.clearNonlinearAd(),this.removeVastLoader(e),new Promise((function(i,r){var n=new bt(e,t.player,t);n.on(A,i),n.on(c,r),n.on(p,t.adPlayerImpressionHandler.bind(t)),n.on(g,t.player.trigger),n.on(P,t.dispatchAdError.bind(t)),n.init(t.blockingInstreamPlayer,t.reason).catch(Et),t.reason=null,t.adInstreamPlayer=t.blockingInstreamPlayer,t.blockingInstreamPlayer=null,t.adPlayerQueue.push(n)})).then((function(){t.isDestroyed()||"nonlinear"===i._type||t.stopBlocking()}))},a.pauseAd=function(e,t){if(this.adPlayerQueue.length){var i=this.adPlayerQueue[this.adPlayerQueue.length-1];e?i.pause(t||{}):i.play(t||{})}},a.skipAd=function(){this.adPlayerQueue.length&&this.adPlayerQueue[this.adPlayerQueue.length-1].skip()},a.dispatchFatalAdError=function(e){e&&e.adErrorCode||(e=Y(this,{message:"An unexpected ad error has occurred",sourceError:e})),this.dequeueAdEvents(),this.dispatchAdError(e),this.destroyPlayers(),this.stopBlocking()},a.destroyPlayers=function(){this.adPlayerQueue.forEach((function(e){return e.destroy()})),this.adPlayerQueue.splice(0)},a.dispatchAdError=function(e){Tt(e)&&(this.qoe.tick("adError"+e.id),e.timeLoading=this.qoe.between("adBreakStart","adError"+e.id)),this.vmapTracker&&this.vmapTracker.error(e.code),50004!==e.adErrorCode&&50901!==e.adErrorCode||!this.player.getAdBlock()||(this.adBlockErrorDetected=!0);var t=70001===e.adErrorCode?"adWarning":c;this.player.trigger(t,e)},a.clearNonlinearAd=function(){this.adPlayerQueue.length&&this.adPlayerQueue[this.adPlayerQueue.length-1].clearNonlinear()},a.getVMAPTracker=function(e){if(!e._vmapTracker){var t=new ft(e,e._trackers,this._debugTrackFn,this.player,this.config);e._vmapTracker=this.vmapTracker=t}return e._vmapTracker},a._loadTag=function(e,t){var i=e._adQueue[e._waterfallIndex];return this._loadTagUrl(e,i,t)},a._loadTagUrl=function(e,t,i){var r=this;return xe(t,this.player,this.item,this.client,this.params,e).then((function(n){"function"==typeof r._debugTrackFn&&r._debugTrackFn({type:"tagReplacement",data:{actualTag:n,originalTag:t}});var a=r._createVastLoader(e,i),s=a.load(n);return i.isPodItemLoader?i.tagIndex&&(a.scheduledAd().adRequestIds[i.tagIndex]=r.player.utils.genId(12)):e._currentTag=n,r._dispatchAdRequest(e,B({tag:n},i)),s}))},a._loadPods=function(e,t){var i=this;e.adRequestIds=[];var r=this._createVastLoader(e,t),n=e._pod.map((function(r,n){var a=B({tag:r,isPodItemLoader:!0,tagIndex:n},t),s=i._loadTagUrl(e,r,a).catch((function(e){return e.tagIndex=n,Promise.reject(e)})),o=function(){return i.isDestroyed()?null:i._dispatchAdLoaded(e,a)};return s.then(o).catch(Et),s.catch(o).catch(Et),s}));return r.podMultipleVastLoaders(n)},a._loadXML=function(e,t){var i=this;return e._currentTag=e._currentTag||e._adXML.toString(),this.bidsPromise.then((function(){return i._dispatchAdRequest(e,t),i._createVastLoader(e,t).parseVast(e._adXML,e._currentTag)}))},a._dispatchAdRequest=function(e,t){var i=$(this,e,B({jwpseg:e.jwpseg},t));this.player.trigger("adRequest",i),this.qoe.tick("adLoading"+i.id)},a._dispatchAdLoaded=function(e,t){var i=$(this,e,t),r=i.id;this.qoe.tick("adLoaded"+r),i.timeLoading=this.qoe.between("adLoading"+r,"adLoaded"+r),this.player.trigger("adLoaded",i)},a._handleVastLoadError=function(e,t,i){var r=e.vloader;return this.removeVastLoader(r),this._getVloaderErrorObject(e,t,i)},a._vloaderWaterfall=function(e,t){var i=this._handleVastLoadError(e,null,t),r=e.vloader;return this.adWaterfall(r,i,t)},a.adWaterfall=function(e,t,i){var r=e.scheduledAd();if(this.schedule.canWaterfall(r))return r.jwpseg=null,r._adXML=null,r._waterfallIndex+=1,this.enqueueAdEvent(c,t,i),this.startAdBreak(r,i);throw t},a._createVastLoader=function(e,t){var i=this;void 0===t&&(t={});var r=this.config,n=new vt(e,this.player,B({requestFilter:r.requestFilter,trackingFilter:r.trackingFilter,item:this.item,params:this.params},t));this._vloaderQueue.push(n);var a=0;return n.on(P,(function(r){a+=1;var s=i._getVloaderErrorObject(r,null,t);if(i.enqueueAdEvent(c,s,t),!(n._scheduledAd._pod&&n._scheduledAd._pod.length===a)){var o=$(i,e,{podIndex:n._scheduledAd._adPodIndex,tagIndex:a});i.enqueueAdEvent(f,o,t)}}),this),n.on(m,(function(e){i.player.trigger(m,B($(i,null),e))})),n},a._getVloaderErrorObject=function(e,t,i){e.wrapperAdSystem&&e.wrapperAdSystem.length!==e.wrappedTags.length&&(e.wrapperAdSystem.push(e.adsystem),e.adsystem="");var r=B({adsystem:e.adsystem,wrapper:e.wrapperAdSystem,wrappedTags:e.wrappedTags},e.vloader.scheduledAd());return Y(this,e,r,B({tag:e.tag,tagIndex:e.tagIndex||t,podIndex:e.podIndex},B({jwpseg:r.jwpseg},i)))},a.dequeueAdEvents=function(){var e=this;this._events.forEach((function(t){var i=t.type,r=t.event;i===c?e.dispatchAdError(r):e.player.trigger(i,r)})),this._events.splice(0)},a.triggerAdBreakEvents=function(e){var t=this,i=this.getVMAPTracker(e);this.blockingInstreamPlayer.once("destroyed",(function(){t.qoe.clear("adBreakStart"),i.breakEnd(),t.player.trigger("adBreakEnd",$(t,e))}),this),this.qoe.tick("adBreakStart"),i.breakStart();var r=$(this,e);this.player.trigger("adBreakStart",r),this.player.trigger(f,r)},a.startBlocking=function(){this.blockingInstreamPlayer||(this.blockingInstreamPlayer=this.player.createInstream().init(),this.blockingInstreamPlayer.setText(null))},a.stopBlocking=function(){if(this.blockingInstreamPlayer||this.adInstreamPlayer){var e=this.blockingInstreamPlayer||this.adInstreamPlayer;this.blockingInstreamPlayer=null,e.destroy()}this.adInstreamPlayer=null},a.loadAd=function(e,t){var i=this;void 0===t&&(t={});var r=this.player.utils;if(e._id=e._id||r.genId(12),e._vmapTracker=this.getVMAPTracker(e),e._adQueue||e._adXML||e._pod){if(t.adBlock)throw Y(this,{message:"Ad playback blocked by an ad blocker",adErrorCode:600003},e,t);var n;if(e._pod)return this._loadPods(e,t);var a=function(){return i.isDestroyed()?null:i._dispatchAdLoaded(e,t)};return(n=e._adXML?this._loadXML(e,t):this._loadTag(e,t)).then(a).catch(Et),n.catch(a).catch(Et),n.catch((function(e){return i.isDestroyed()?null:i._vloaderWaterfall(e,t)}))}r.log("scheduled ad has no url or xml",e)},a.playPreloadedPromise=function(e,t){var i=this;void 0===t&&(t={}),e.then((function(e){return i.tryPlayAd(e,t)})).catch((function(e){i.isDestroyed()||(i.dispatchAdError(e),i.stopBlocking())}))},a.startAdBreak=function(e,t){var i=this;return void 0===t&&(t={}),this.bidsPromise.then((function(){return i.loadAd(e,t)})).then((function(e){return i.tryPlayAd(e,t)})).catch((function(e){i.dispatchAdError(e),i.stopBlocking()}))},a.removeVastLoader=function(e){var t=this._vloaderQueue.indexOf(e);-1!==t&&(e.destroy(),this._vloaderQueue.splice(t,1))},a.isDestroyed=function(){return null===this.player},a.destroy=function(){this._vloaderQueue.forEach((function(e){return e.destroy()})),this.clearNonlinearAd(),this.destroyPlayers(),this.stopBlocking(),e.prototype.destroy.call(this)},n}(lt),It=function(){},Ct=function(){function e(e,t,i){this.player=e,this.pluginConfig=t,this.adClient=i;var r=this.configParser=new it(e.utils),n=this.adRules=new st(e,r.getAdRules(t),i);this.emptySchedule=new Ze(n,e.utils)}var t=e.prototype;return t.getAdRules=function(){return this.adRules},t.resetDefaultSchedule=function(e){var t=void 0===this.pluginConfig.withCredentials||this.pluginConfig.withCredentials,i=this.defaultSchedule=this.configParser.getSchedule(this.pluginConfig,this.adRules);i.isVMAP()&&i.load(this.player,e,this.adClient,{withCredentials:t}).catch(It)},t.getSchedule=function(e,t){return t>0&&!this.adRules.rulesAllowAdPlayback(t)?this.emptySchedule:e&&e.adschedule?this.configParser.getSchedule(e,this.adRules):(this.resetDefaultSchedule(e),this.defaultSchedule)},t.getOptParams=function(e,t){return this.configParser.getOptParams(e,t)},t.reset=function(){this.adRules.reset()},t.destroy=function(){this.emptySchedule&&this.emptySchedule.destroy(),this.defaultSchedule&&this.defaultSchedule.destroy()},e}(),St={},xt={},Rt={};function jt(e,t){var i=St[t];return i||(St[t]=new Promise((function(i,r){var n=new e.key(t);if("unlimited"===n.edition())return r();var a=["//","entitlements.jwplayer.com","/",n.token(),".json"];"file:"===window.location.protocol&&a.unshift("https:"),e.ajax(a.join(""),(function(e){var t=e&&e.response;t?i(t):r()}),(function(){r()}),{timeout:1e4,responseType:"json"})})))}function Ot(e,t){var i=xt[t];return i||(xt[t]=jt(e,t).catch((function(){return{}})).then((function(e){if(!1===e.canUseVPB)throw new Error("Not entitled for Player Bidding")})))}var Vt=function(e,t,i){var r=Rt[t];return r||(Rt[t]=jt(e,t).catch((function(){return{}})).then((function(e){var t,r;if(!0===i.outstream?(t=!1!==e.canPlayOutstreamAds,r="Outstream Ad Limit Reached"):(t=!1!==e.canPlayAds,r="Ad Limit Reached"),!1===t)throw new Error(r);return{message:"Can Play Ads"}})))},Mt=function(){};var Bt="8.11.0",Lt=function(){};!function(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");t.setAttribute("media","screen"),t.innerHTML=e,document.head.appendChild(t)}}(".jwplayer.jw-flag-time-slider-above .jw-vpaid-non-linear{bottom:66px}.jwplayer.jw-breakpoint-7 .jw-vpaid-non-linear{bottom:132px}.jwplayer.jw-flag-user-inactive:not(.jw-state-paused) .jw-vpaid-non-linear{bottom:.5em}.jwplayer .jw-vpaid-non-linear{bottom:60px}.jwplayer .jw-vpaid-iframe{border:0;width:100%;height:100%;position:absolute;overflow:hidden}.jwplayer .jw-plugin-vast.jw-plugin{top:0;width:100%;pointer-events:none}.jwplayer .jw-plugin-vast.jw-plugin *{pointer-events:all}.jwplayer .jw-plugin-vast .jw-ad-icon-container{position:absolute;display:none;pointer-events:all;cursor:pointer}.jwplayer .jw-plugin-vast .jw-ad-icon-container.jw-ad-icon-active{display:block}.jwplayer .jw-plugin-vast .jw-ad-icon-container iframe{pointer-events:none;border:none;height:100%;width:100%;margin:0}.jw-plugin-vast.jw-vast-nonlinear-active .jw-banner{opacity:1}.jw-plugin-vast.jw-vast-nonlinear-active .jw-vast-nonlinear-close-button{margin:0 auto;opacity:.75}.jw-plugin-vast.jw-vast-nonlinear-active:hover .jw-vast-nonlinear-close-button{opacity:1}.jw-plugin-vast.jw-vast-nonlinear-collapsed .jw-vast-nonlinear-open-button{margin:0 auto;opacity:.5}.jw-plugin-vast.jw-vast-nonlinear-collapsed .jw-banner,.jw-plugin-vast.jw-vast-nonlinear-collapsed .jw-vast-nonlinear-close-button{opacity:0}.jw-plugin-vast.jw-vast-nonlinear-collapsed:hover .jw-vast-nonlinear-open-button{opacity:1}.jw-plugin-vast.jw-vast-nonlinear-collapsed:hover .jw-vast-nonlinear-close-button{opacity:0}.jw-plugin-vast .jw-vast-nonlinear-close-button,.jw-plugin-vast .jw-vast-nonlinear-open-button{position:absolute;right:0;bottom:0;left:0;display:block;margin:auto;width:18px;height:18px;cursor:pointer;opacity:0;transition:opacity .2s ease}.jw-plugin-vast .jw-vast-nonlinear-close-button{transform:rotate(45deg)}"),(window.jwplayerPluginJsonp||window.jwplayer().registerPlugin)(t,"8.1",(function(e,i,r){var a,s,o,l,d=this,h=new Ct(e,i,t),u=e.getConfig(),c=e.getEnvironment(),p=i.debug&&i.trackFn?i.trackFn:null,f=e.utils,m={withCredentials:void 0===i.withCredentials||i.withCredentials},v=!1,g=0,y=!1;(function(e){try{var t=e.settings.mediationLayerAdServer||"jwp",i=Boolean(e.bidders.length);return("jwp"===t||"jwpspotx"===t)&&i}catch(e){return!1}})(i.bids)&&(l=B({},i.bids)),function(e,t,i,r){var n,a=t.key,s=e.utils,o=Vt(s,a,i);o.catch(Mt),i.bids&&(n=Ot(s,a)).catch(Mt),e.on("ready",(function(){n&&n.catch((function(i){e.trigger("destroyBidding"),e.trigger(de,Ce(i.message,60009,t,r))})),o.catch((function(i){e.trigger("destroyPlugin",i),e.trigger(de,Ce(i.message,60002,t,r))}))}))}(e,u,i,t),"enabled"===i.omidSupport&&ct(f).catch(f.noop),this.version=Bt,B(this,e.Events),r&&f.addClass(r,"jw-plugin-vast");var k=function(t){a&&(t&&(s=a.next,v=a.nextPlaylistRelated),a.schedule.reset(),a.off(null,null,d),a.destroy(),a=null),h.reset(),e.setCues([])},A=function(t){var i=t.getMidRolls(),r=[];i.length&&i.forEach((function(e){"nonlinear"!==e._type&&r.push({begin:e._offSet,text:m.cuetext,cueType:"ads"})})),e.addCues(r)},P=function t(r,n,a){var s=h.getSchedule(r,n),u=new _t(e,s,r,i,a,o,y);return u.init(l,a).then((function(){u.isDestroyed()||e.trigger("adSchedule",$(u,null,{schedule:s}))})).catch(Lt),u.on("preloadNext",(function(e){var i=B({},a,{preloadPreroll:!0,playlistItemEventCount:g+1});u.next=t(e.item,i.playlistItemEventCount,i)}),d),u};e.on({ready:function(){u.localization=e.getConfig().localization,(m=h.getOptParams(i,u.localization.advertising)).debugTrackFn=p,o={staticPlayer:new U(e,r),companion:new H(p,c,{openLink:f.openLink}),div:r,optionalParams:m}},cast:function(e){y=Boolean(e.active)},play:function(e){d.trigger(n,e)},playlistItem:function(t){g+=1,k(!0);var i=e.getPlaylistItem(t.index);s&&i!==s.item&&!v&&(s.off(null,null,d),s.destroy(),s=null,v=!1),m.playlistItemEventCount=g,(a=s||P(i,g,m)).attachListeners(),s=null,v=!1,a.schedule.isVMAP()?a.vmapPromise.then((function(){a.isDestroyed()||A(a.schedule)})).catch(Lt):A(a.schedule)},playlistComplete:k,complete:function(){a&&a.clearNonlinearAd()},destroyPlugin:k,destroyBidding:function(){l=null}},this),e.pauseAd=function(e,t){e="boolean"!=typeof e||e,a&&a.pauseAd(e,t)},e.playAd=function(t){var i,r=0===m.requestTimeout?1/0:m.requestTimeout,n=0===m.creativeTimeout?1/0:m.creativeTimeout;i=Array.isArray(t)?t.slice(0):[t];var s=f.genId,o={_id:s(12),_adQueue:i,_waterfallIndex:0,_adPodIndex:0,adBreakId:s(12),_offset:0,_position:K(e),requestTimeout:r||5e3,creativeTimeout:n||15e3};a?(a.clearNonlinearAd(),a.playAdAPI(o)):e.once("playlistItem",(function(){return a.playAdAPI(o)}),d)},e.skipAd=function(){a&&a.skipAd()},this.destroy=function(){if(a&&(a.schedule.reset(),a.off(null,null,d),a.destroy(),a=null),s&&(s.schedule.reset(),s.off(null,null,d),s.destroy(),s=null),h.destroy(),o){var e=o.staticPlayer;e&&e.destroy()}}}))}();
